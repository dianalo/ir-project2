<?xml version='1.0' encoding='UTF-8'?>
<DOC><DOCNO> ZF32-021-003 </DOCNO><DOCID>11 485 390</DOCID><JOURNAL>DEC Professional  Nov 1991 v10 n11 p60(7)* Full Text COPYRIGHT Professional Press Inc. 1991.andM;</JOURNAL><TITLE>I/O subsystem performance: part 7: the theories, advantages anddisadvantages of different methods of disk striping.andO;(Input/Output) (Storage) (Technical)</TITLE><AUTHOR>Bates, Kenneth H.andM;</AUTHOR><SUMMARY>Disk striping is one technique that can improve input/output (I/O)performance over the performance of a single disk, or sets ofun-striped disks.andP;  The method works by combining multiple disksinto one logical unit.andP;  Disk striping allows for automatic loadbalancing from all disks in the stripesets and increases data andrequest rates.andP;  It does this by employing overlapped accesses,decreasing the average response time by spreading the load amongmembers of the stripeset.andP;  Striping requires multiple disks, andintroduces complications into the I/O system by adding a stripinglayer.andP;  Furthermore, the time needed for data backup andrestoration becomes an issue, as do the high capacities that arepossible when combining disks.andP;  All disks must also be fullyoperational for successful performance enhancement.andP;  Three ways toachieve striping include a hardware-based method, file striping,and using a VMS striping driver that essentially places a devicedriver in between an application and the physical device driver asa compromise between the other two methods.andM;</SUMMARY><DESCRIPT>Topic:     I/O ManagementDisk DrivesData Transfer RateLogical OrganizationTechnical InstructionPerformance ImprovementTutorial.andO;Feature:   illustrationcharttable.andM;</DESCRIPT><TEXT>Editor's note: This article is the seventh in a series on I/O subsystemperformance.andP;  Previous articles appeared in April, August and October 1989,March and September 1990, and February 1991.andM;Disk striping is a technique for combining two or more disk drives into asingle virtual unit.andP;  This is done to increase I/O performance over that of asingle disk drive or a set of unstriped disks.andP;  Disk striping was originallydeveloped to increase the data rate, but as we shall see, it has much widerapplicability in the area of load balancing on the typical VMS system.andP;  Inthis article, we explore the theory behind disk striping and the various waysit can be implemented.andP;  In a future article, we will examine the effects ofstriping on performance and provide information about how to tune striping toobtain the best disk performance.andM;To understand how disk striping works, you must first remember the model ofthe storage device.andP;  In this model, the user application never directly talksto a disk drive.andP;  Instead, it directs commands to a device driver in theoperating system.andP;  That driver in turn sends the commands to the I/Ocontroller.andP;  The controller interprets these commands and then passes them onto the actual physical device.andM;The key to Digital Storage Architecture (DSA) is that the host operatingsystem sees the storage device as a contiguous series of logical blocks,numbered sequentially from 0 to the maximum.andP;  The filesystem on the hostselects a particular logical block number (LBN) for transfer (together with abyte count) and then requests the subsystem to transfer that data.andP;  Themechanics of translating the LBN to the physical unit and block number arethe responsibility of the controller.andM;For example, consider Figures 1 through 3, which depict several possibleconfigurations of two physical disk drives.andP;  Figure 1 illustrates thetraditional picture.andP;  In this case, physical disks I and 2 are distinct diskdrives, each of which has a total of 1,000 logical blocks.andP;  Each disk isknown to the application, and the application can address each unitindependently.andP;  The application has a total of 2,000 blocks at its disposal.andO;LBNs 0 through 999 reside on unit 1, and LBNs 0 through 999 reside on unit 2.andM;Another possible configuration is disk shadowing, shown in Figure 2.andP;  In thisconfiguration, disks 1 and 2 have been combined into one virtual unit,numbered 1234.andP;  The application sees one unit, 1234, even though two physicaldisks exist.andP;  In this case, the application thinks that unit 1234 has a totalof 1,000 blocks, numbered 0 through 999.andP;  The reason is that the HSC (VolumeShadowing Phase 1) or the host  Volume Shadowing Phase 11) has bound the twophysical disks into one virtual unit and has presented the resulting unit tothe application.andP;  When the application accesses unit 1234, the controller (orhost, for Volume Shadowing Phase 11) knows that this unit is actually ashadow set and proceeds accordingly.andM;The clear advantage of shadowing is that data is duplicated on both disks.andO;In the event of a disk failure of disk 1 or disk 2, the data is stillaccessible on the other physical disk.andP;  Since the application accesses datathrough the virtual unit number (1234), the &quot;shadowing layer&quot; masks thephysical disks from the application.andM;Another advantage is that since data is duplicated on both disks, readcommands may obtain data from either disk.andP;  If two read commands areoutstanding, then both may proceed in parallel.andP;  In addition, it is possibleto direct the command to the disk that is closest to the desired cylinder,thereby reducing the seek time.andP;  With the large numbers of read commands in atypical VMS workload, this may result in a performance improvement of 50 to75 percent.andP;  The disadvantage of this approach is that a total of 2,000 LBNshave been dedicated to storing 1,000 LBNs, giving a storage efficiency of 50percent.andM;Having seen how physical disks may be translated into another representationby the operating system or I/O subsystem, we can now examine how a stripesetis organized.andP;  An example of a stripeset is shown in Figure 3.andM;In Figure 3, the same two disks exist, but now they have had their LBN spacereorganized.andP;  In this case, all even-numbered LBNs reside on physical disk 1,while odd-numbered LBNs reside on physical disk 2.andP;  Both physical units arebound into a stripeset and presented to the application as virtual unit 3456.andO;The application now sees one unit with a capacity of 2,000 LBNs, sequentiallynumbered from 0 to 1,999.andM;The function of the software and hardware that exist between the applicationand the physical units is to translate requests from the application intorequests for the specific drive.andP;  If, for example, the application wanted toread LBN 4, the translator would have to know that this was actually thethird logical block on physical disk drive 1.andP;  Chunk Size In Figure 3, thelogical blocks have been divided on the basis of whether they are odd oreven.andP;  A more general scheme is to allow the division based on another value.andO;This value, known as the chunk size, describes how many consecutive logicalblocks exist on one physical disk before they continue on the next unit.andO;This is shown in Figure 4 for a chunk size of four on a two-disk stripeset.andM;In Figure 4, disk 1 has logical blocks 0 through 3 as the first chunk.andP;  Sincethe chunk size is four, the next sequence of four blocks is placed on unit 2.andO;Even though these blocks reside on physical blocks 0 through 3, they areconsidered to be logical blocks 4 through 7.andP;  Similarly, the next four blocksare in the third chunk, so they will reside on the next four physical blockson unit 1.andM;Dividing consecutive address locations on a disk is quite similar to theaddressing used in interleaved memories.andP;  With a single bank of memory, thememory hardware may take some time to recover once data has been transferred.andO;As a result, a fast CPU will have to wait for this recovery, which slows theeffective cycle time of the CPU.andP;  In one implementation of memoryinterleaving, even-numbered bytes are located in one physical memory bank,while odd-numbered bytes are located in the other memory bank.andP;  When aprogram accesses sequential bytes from memory, the memory controlleralternates between the two banks supplying data to the program.andP;  Withinterleaving, the second bank of memory can be accessed while the first isrecovering from the previous access.andP;  In this fashion, the effective memoryspeed can be nearly doubled.andM;Disk striping uses the principle of overlapped accesses to increase the datarate.andP;  Picture a transfer request for logical blocks 0 through 7.andP;  In atraditional disk drive, this request would take a total of eight sectortimes.andP;  Referring to Figure 4, however, you can see that the picture issomewhat different for a striped disk.andP;  In this case, LBNs 0 through 3 areread from disk 1, while LBNs 4 through 7 are read from disk 2.andP;  Since theseLBNs reside on separate disks, they can be transferred in parallel.andP;  Theresulting time for the transfer is four sector times, even though a total ofeight sectors has been transferred.andP;  In effect, the data rate has beendoubled, since the same amount of data, eight sectors, has been delivered inhalf the time.andM;If this data rate is not high enough, the stripeset may be configured withthree members.andP;  With a chunk size of four, LBNs 0 through 3 reside on disk 1,LBNs 4 through 7 reside on disk 2, and LBNs 8 through 11 reside on disk 3.andO;Accessing LBNs 0 through 11 causes all three disk drives to transfer inparallel.andP;  The total time for transferring all 12 sectors is still foursector times, or three times the data rate of one disk.andM;From the standpoint of load balancing, consider two requests for data, one toLBN 3 and one to LBN 20.andP;  These requests could be either to different blocksin the same file or from different users for data in different files.andP;  In anonstriped disk, the first request is serviced by the disk, and the totalresponse time consists of seek, rotation and transfer times.andP;  The secondrequest is delayed until the completion of the first, since the disk is busy.andO;Therefore, its response time not only consists of seek, rotation and transfertimes, but also has the response time of the first request added to it.andM;With the stripeset layout shown in Figure 4, however, both requests couldproceed in parallel.andP;  The first request completes in the same time, but sincethe second request does not have to wait for the first to complete, itfinishes much more quickly.andM;When many applications are accessing data at a high request rate, thestatistical distribution of the requests from striping spreads the loadacross the members of the stripeset, thereby reducing the average responsetime.andP;  Spindle Synchronization In the case discussed above, if there weremore than four logical blocks per disk revolution, then some rotationallatency would occur, since the disk is not always at the exact pointnecessary to transfer the data.andP;  With one disk, the average rotationallatency is about half a revolution, or 8.33 ms for a disk that rotates at3,600 rpms.andM;If two disks are involved in the transfer, then the rotational latencies ofboth disks are involved.andP;  This is because the high-level transfer is notcomplete until the transfers on both disks are complete.andP;  Since the disksrotate independently of each other, the average rotational latency is themaximum of the average rotational latencies for both disks.andP;  Thisrelationship holds true as the number of disks in a stripeset is increased,and it may be calculated as:andM;Average stripeset latency =   n *  randM;_______n +  1andM;Where: n =  Number of disks in theandM;stripesetandM;r =  Rotation timeandM;In the two-disk case (n = 2) with an RA92 (r = 16.67 rm), the averagerotational latency is about 11.11 ms, or an increase of 33 percent over thesingle-disk case.andM;To reduce this increased latency, you can electrically connect the disks sothat they are rotationally synchronized.andP;  When the first sector on disk 1(LBN 0) spins under the disk head, the first sector on disk 2  LBN 4) is alsounder the disk head.andP;  In this manner, the average rotational latency of astripeset equals the average rotational latency of a single disk, typically8.33 ms.andM;Additional latency is stiff incurred if the transfer spans more than one diskand the transfers from both disks cannot begin at the same time.andP;  The exactvalue for this latency is difficult to pinpoint, since it depends not only onthe size of the transfer and where the transfer begins on one disk and endson another, but also on whether the controller implements fragmentation androtational position optimization.andM;Although synchronizing the rotation of the disks eliminates the extrarotational latency if a transfer spans a chunk, it requires specializedhardware.andP;  As we will see, selection of the chunk size makes it possible toreduce this extra latency to a very small amount without the necessity ofsynchronization.andP;  Filesystem interaction Although the individual blocks inthe stripeset are distributed across multiple units, this is hidden from theapplication and filesystem.andP;  The filesystem simply accesses a particular LBN.andO;The striping layer translates this request into a specific LBN on aparticular disk.andP;  For example, the index file on a VMS system, INDEXF.SYS,might begin at LBN 500,000 and extend for several thousand blocks.andP;  When VMSrequests LBN 500,000, the striping layer performs some simple calculationsand issues a request to the disk that has the appropriate LBN.andM;In the case shown in Figure 4, the integer chunk number is obtained bydividing 500,000 by the chunk size of four.andP;  This results in a chunk numberof 125,000, which is located on disk 1.andP;  Because each disk has only everyother chunk number, this is located 62,500 chunks from the beginning of thatdisk.andP;  Since the chunk size is four, it is then easy to multiply and obtainLBN 250,000 on disk number 1.andP;  The striping layer then transfers this LBN.andM;The important point is that the details of which actual LBN on which physicaldrive represents the requested LBN are hidden from the filesystem.andP;  Thefilesystem requests LBN 500,000 from the virtual unit representing thestripeset, and the striping layer translates that request into an actual I/Ooperation to the disk.andP;  The filesystem simply sees a very large and very fastdisk drive.andP;  How the data is organized is controlled by the striping layer.andO;Cost Of Striping As you might expect, there are costs associated withstriping.andP;  The first is that multiple disks are required.andP;  Since nearly allsystems use more than one disk and the existing disks may be combined into astripeset, this is not a concern.andP;  Moreover, since the resulting capacity fora two-member stripeset is twice that of a single disk, this is not a realconsideration.andM;A second consideration is the additional complexity introduced into the I/Osubsystem by the presence of the striping layer.andP;  The translation between therequested LBN and the resulting physical I/O requires the striping layer toperform calculations, which imposes additional latencies.andP;  The amount of codeinvolved in this translation is relatively small, so there is no noticeableimpact on performance.andP;  In some implementations, it may also be necessary forthe striping layer to &quot;reserve&quot; a few blocks on the individual members forcertain information, such as the number of members and mapping information.andO;However, with the large capacities of today's disk drives, the reduction of afew kilobytes of data is rarely cause for concern,andM;Another concern is data backup and restoration.andP;  Because you can combinelarge numbers of disks into a single stripeset, extremely high capacities arepossible.andP;  The time necessary to back up and restore this data can beconsiderable.andP;  As an example, a six-member stripeset of RA92 disks has acapacity of more than 7 GB.andP;  A fuR backup or restore to this disk would be alengthy task.andM;The final factor is more serious, and that is that all disks must beoperational to access data on a stripeset.andP;  For example, if a two-member setwere constructed, as in Figure 4, loss of disk 1 would result in losing fourblocks of every eight.andP;  Because the stripeset is represented to the operatingsystem as one drive, the entire stripeset has become unusable.andP;  This issimilar to losing the root volume from a bound volume set.andP;  Even though theother drives are operational, the logical unit is inaccessible.andM;The specification that describes the life of a disk is mean time betweenfailures (MTBF).andP;  MTBF, which is normally specified in hours, indicates theaverage life of a drive before a failure occurs.andP;  In a disk farm withidentical disk drives, the average time between the failure of any disk canbe simplistically calculated by dividing the MTBF by the total number ofdisks.andP;  As an example, if a disk has an MTBF of 50,000 hours, then in a diskfarm of 100 units, a disk failure would occur once every 500 hours on theaverage.andM;This has ramifications for a stripeset, since the failure of any member of astripeset results in the failure of the stripeset as a whole.andP;  If atwo-member set were to be constructed of drives with an MTBF of 50,000 hourseach, then a failure of a drive (and the stripeset) could be expected every25,000 hours on the average.andP;  With the MTBF of modern drives approaching 5 to10 years, this is not as much cause for concern as it once was.andP;  However, forhigh-availability systems, it is nonetheless a factor to be considered.andP;  Aswe win see, specific implementations of striping may reduce this concern byproviding high-availability alternatives.andP;  implementation From a high-levelperspective, an that is required for striping is a collection of disks (thestripeset) and a means of distributing the LBNs directed to that stripeset tothe individual disks (the striping layer).andP;  There are a number of ways toaccomplish this, each of which has its advantages and disadvantages.andO;Hardware-Based - The first possibility is to implement striping by hardware.andO;In this case, multiple disk drives are bundled into one physical unit.andO;Hardware and microcode are inserted between the disks and VAX interface, andthe entire unit is presented to the VAx as one physical unit.andP;  As shown inFigure 5 on page 64, the VAX system sees only a single disk drive.andP;  Ofcourse, more than two disks could be in the storage unit.andM;In operation, the VAX directs I/O requests to the disk.andP;  The microcodeinterface in hardware receives that request and directs it to the appropriatedisk drives.andP;  The advantage of this approach is that the implementation istotally transparent to the VAX host.andP;  From the standpoint of both the VAX andthe application, only one disk exists.andP;  Because of this, no modifications arerequired to either the operating system or the application programs.andP;  Sincestriping is implemented in hardware, you can have elaborate error-recoveryschemes.andP;  As an example, a parity disk could be added that might allowrecovery if one disk fails.andP;  Because the implementation is in hardware, errorcorrection can be done at hardware speeds.andP;  At the same time, a hardwareimplementation could easily include disk synchronization.andM;This scheme has drawbacks, however.andP;  As you might expect, considerabledevelopment effort is required.andP;  Although this does not affect the resultingproduct, the technology requires a fair amount of time and money.andP;  Inaddition, the number of disks in the stripeset is fixed.andP;  If an applicationneeded the data rates provided by more than two disks, for example, it wouldbe a major task to add extra disks.andM;Another factor is that all data from the storage unit flows over a single I/Obus.andP;  For extremely high data rates, this may require new I/O buses and VAXI/O adapters.andM;Finally, the maximum data rate is obtained when the I/O size is equal to thesum of all track sizes of the individual stripeset members.andP;  Some controllerslimit the maximum MSCP request size issued by VMS to 127 sectors.andP;  If alarger request is issued by the application program, that request will bebroken into multiple requests of 127 sectors or fewer before being sent tothe I/O subsystem.andP;  With many disks in the stripeset, the optimum requestsize can be much greater than 127 sectors.andP;  If VMS were to issue requests in127-sector sizes, then the potential data rate of the storage unit might notbe realized.andM;Although the last two concerns could be addressed by additional developmenteffort, this effort would certainly add to the overall time.andP;  This solutionhas the potential to be one of the best, but it requires considerableinvestment and time to implement at all levels.andP;  File Striping - A secondpossibility is to stripe specific files instead of physical units.andP;  In thisscheme, an application that needs increased data rates calls software libraryroutines to access the file.andP;  These routines place pieces of each file onseparate disks.andP;  The individual disks are seen by the operating system asnormal, but the file being striped is spread across the selected disks.andM;To create a file, the application invokes a routine that creates multiplesubfiles on the disks.andP;  When accessing the file, the application invokes aroutine that determines which portion of which file on which disk had thedesired data.andP;  An example of this is shown in Figure 6 on page 64.andM;In Figure 6, the application requests that one file be created.andP;  The libraryroutine creates two files, one on disk 1 and one on disk 2.andP;  If theapplication accesses this file by invoking the library routine, the libraryroutine directs I/O requests to the individual segments of the file.andM;An advantage of this approach is that since only individual files are stripedon regular disks, loss of one disk does not affect other files.andP;  The stripedfile is inaccessible, since part of it is on the failed disk, but all otherfiles on the remaining disk may be accessed.andM;When you create a striped file, the number of disks needed may be specifiedat file creation time.andP;  If one application needs the data rate of two diskswhile another needs the data rate of five, both can be accommodated.andP;  Becauseeach disk is connected to an individual I/O bus, the data rate limitation isthe sum of all buses.andP;  In many cases, this yields a much higher rate.andM;Also, since each I/O request is directed to a single disk by the libraryroutines, any queued input/output (QIO) size limitation is on a per-diskbasis, rather than on the stripeset as a whole.andP;  As a result, the byte countfor the optimum data rate can be obtained.andM;In spite of these advantages, two severe restrictions exist.andP;  First, to usethis method, an application must be modified to invoke the library routines.andO;In many cases, this effort is great enough to discourage its use.andP;  Second,since the striped file exists as two individual data files on separate disks,backup of the overall file becomes quite complex.andP;  The files must be backedup (or restored) as a unit, or the resulting data will be meaningless.andO;Because of these disadvantages, this approach is practical in a very fewcases.andP;  VMS Striping Driver - The final method of implementing striping is acompromise between the other two approaches and produces surprisingly goodresults.andP;  In this method, a VMS virtual device driver is interposed betweenthe application and the physical device driver.andP;  Conceptually, this driverbinds multiple disk devices into one virtual device and presents that deviceto the user.andP;  The user simply treats the virtual device as a real disk.andM;The striping driver receives I/O requests from the applications, performs thestripeset mapping calculations, and then passes requests to the physicaldevice drivers.andP;  You can see this in Figure 7 on page 66.andM;In operation, the application issues QIO requests to virtual device STA1:.andO;The striping driver intercepts these requests and decides to which physicalstripeset members the requests should be directed.andP;  It then issues I/Orequests for devices DUAO:, DUA1:, and so on.andP;  These are the normal devicedrivers within VMS, which then issue MSCP requests to the disk drives.andO;Because the user application issues I/O requests to a virtual device,striping is totally transparent to all VMS applications.andP;  Striped files canbe backed up and restored like unstriped files, files can be opened normally,and all I/O operations proceed as usual.andM;As with the library approach, different numbers of disks can be configured ina stripeset as required, and I/O to the disks travels over separate I/Obuses.andP;  Since I/O to a specific disk is issued by the normal VMS devicedriver, the 127-sector limitation does not apply, and maximum data rates maybe realized.andM;The only disadvantage of this approach relates to the failure of a memberdisk in a stripeset, which is present on all forms of striping.andP;  This can bereduced by shadowing each stripeset member, effectively producing a stripesetof shadow sets.andP;  Because this approach doubles the number of disks required,an alternative is to use VAXsimPLUS in the predictive mode with autocopyenabled.andM;With this mode, each stripeset member is created as a single-member shadowset, with one spare drive.andP;  The recommended ratio is one spare for everyeight to 10 disk drives.andP;  If VAXsimPLUS detects an impending failure on aunit, it automatically performs a shadow copy operation from the failing unitto the spare.andP;  After the copy, the failing unit is removed, leaving the spareunit in its place.andP;  In this manner, full access to the stripeset is retained.andO;DISK STRIPING IS SIMPLY a means of combining multiple disks into one logicalunit to achieve higher data and request rates.andP;  This may be done in severalways, each of which has advantages and disadvantages.andP;  Although the effectiveMTBF of the stripeset is lower than that of a single disk, a stripeset ofshadow sets can remedy this possible problem.andM;Note that this MTBF of the stripeset is exactly the same as a bound volumeset composed of the same number of disks.andP;  The advantage of disk stripinglies in its ability to provide automatic load balancing among all disks inthe stripesets as well as to increase both the data and request rates.andP;  Howthis is accomplished and the specific performance increases possible will bethe subject of the next article.andP;  -Kenneth H. Bates is a consulting softwareengineer for Digital Equipment Corporation in Colorado Springs, Colorado, anda member of the I/O Performance Group.andO;</TEXT></DOC>