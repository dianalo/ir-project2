<?xml version='1.0' encoding='UTF-8'?>
<DOC><DOCNO>  ZF109-715-989  </DOCNO><DOCID>09 715 989.andM;</DOCID><JOURNAL>Microprocessor Report  Dec 12 1990 v4 n23 p1(6)* Full Text COPYRIGHT MicroDesign Resources Inc. 1990.andM;</JOURNAL><TITLE>Echelon's LON revolutionizes distributed control; &quot;neuron&quot; chipscombine three CPUs, I/O, and network interface. (highly flexible,low-cost local operating network system consists of Neuron chipsand firmware, LonTalk network protocol, LonWorks transceivers andLonBuilder Developer's Workbench to implement a wide variety ofdistributed automation and control applications; related articlediscusses price and availability) (product announcement)</TITLE><AUTHOR>Slater, Michael.andM;</AUTHOR><DESCRIPT>Company:   Echelon Systems Corp. (Product introduction).andO;Topic:     Product IntroductionControl SystemsDistributed SystemsProcessor ArchitectureCircuit DesignIntegrated CircuitsNew TechniqueLow CostAdaptability.andO;Feature:   illustrationtablechart.andO;Caption:   Key features of the first two Neuron chips. (table)Timer input and output functions. (table)Block diagram of the 3150 Neuron chip. (chart)andM;</DESCRIPT><TEXT>Echelon's LON Revolutionizes Distributed ControlandM;Echelon Corp.'s long-awaited LON (local operating network) system has finallybeen revealed, and it promises to revolutionize distributed control andautomation in a wide variety of areas.andP;  Echelon has developed a low-costnetworking technology that can be applied to home, industrial, and commercialautomation.andP;  The company claims to have identified more than 400 potentialapplications.andM;Echelon was founded in February 1988 by Mike Markkula, a cofounder and earlyleader of Apple Computer.andP;  Ken Oshman, cofounder and former President ofRolm, joined later that year as Chairman and CEO.andP;  The company has raised atotal of $30 million in venture financing from more than a dozen investors,including top-notch venture capital firms (including Venrock Associates,Mayfield Fund, Mohr-Davidow Ventures, and Kleiner Perkins Caufield andamp; Byers),individuals including Markkula, Oshman, and Arthur Rock, and corporationsincluding Appel Computer and 3COM Corp.andP;  The company currently hasapproximately 65 employees, and is based in Palo Alto, CA.andM;Echelon has been working closely with dozens of major manufacturers topromote their technology.andP;  The list of 17 &quot;key companies already working withEchelon&quot; includes companies such as:andM;* Leviton (wiring devices)andM;* Johnson Controls (building controls)andM;* Allen-Bradley (industrial automation)andM;* Advance Transformer, Helvar, Leax Limited, and Lithonia Lighting (ballastsand lighting systems)andM;* Ziatech Corp. (board-level computers)andM;* IBM and Eastman Kodak (computer and office equipment)andM;* AMP (connectors and switches)andM;* Sony and ATandamp;T Consumer Products (consumer electronics)andM;This is an impressive list both in terms of the size of the companies and therange of industries represented.andP;  It is not clear, however, how committedeach of these companies is to actually developing and marketing productsbased on Echelon's technology.andM;There are four principal elements of &quot;LONWORKS&quot; technology:andM;* NEURON chips and associated firmwareandM;* LONTALK network protocolandM;* LONWORKS transceiversandM;* LONBUILDER Developer's WorkbenchandM;The NEURON chips, which combine a specialized processor with networkinterface and I/O logic, will be manufactured by Motorola and Toshiba.andP;  Chipsare expected to cost under $10; the goal is well under $5 in volume.andP;  Echelonhas licensed the chip design to their two semiconductor partners.andP;  Bothcompanies will produce pin-compatible chips, each using its own memorytechnologies with an Echelon-supplied logic design.andM;The firmware will eventually be embedded in the NEURON chips.andP;  It provides acomprehensive set of resources for implementing distributed control systemsusing the LONTALK network protocol.andP;  In addition to providing networkservices, the firmware provides an event-driven scheduler that allowsapplication programs to be written as multiple, independent tasks.andM;The LONWORKS transceivers provide the physical interface to a variety oftransmission media, including radio frequency, carrier current (using powerlines), and twisted pair.andP;  The protocol is media-independent, andtransceivers for infrared, coaxial cable, and fiber optic cable may beavailable in the future.andM;The LONBUILDER Developer's Workbench provides a sophisticated development anddebug environment for LON systems, and includes an extended C language forwriting applications to run on the NEURON chips.andP;  In addition to traditionalsoftware development facilities, LONBUILDER includes tools to manage,configure, and debug distributed applications.andP;  Echelon expects developmenttools to be a major part of their business.andM;NEURONSandM;Figure 1 shows a block diagram of the first NEURON chip, the 3150.andP;  (Motorolacalls it the 143150, while Toshiba labels it the TMPN3150.)andP;  Table 1 showsthe key attributes of this chip and the 3120, a future version with on-chipROM for the NEURON chip firmware in addition to the EEPROM and SRAM.andM;A NEURON chip includes three identical CPUs, each dedicated to a specific setof tasks:andM;* CPU 1 implements the media access control (MAC) layer, the lowest level ofthe seven-layer network protocol.andP;  It controls the network interface andexecutes the collision avoidance algorithm.andM;* CPU 2 implements the higher levels of the network protocol, includingaddressing, transaction processing, and network management.andM;* CPU 3 executes the application program.andM;The software for CPU 1 and CPU 2 is part of Echelon's firmware.andP;  Applicationsoftware runs only on CPU 3.andP;  CPU 1 and CPU 2 communicate via network packetbuffers in shared memory.andP;  The application program running on CPU 3 issuesnetwork requests to CPU 2 by writing Service Interface Control Blocks (SICBs)to the shared memory.andM;While the three CPUs are logically independent, they share a common ALU andinstruction decoder.andP;  Each CPU has its own register set and uses the ALU andinstruction decoder on every third cycle.andP;  This provides complete isolationof the three tasks and eliminates all task-switching overhead.andP;  NationalSemiconductor used a similar technique to make a dual-processor COPS familychip.andM;The 8-bit CPU is stack-oriented, so the register set is small.andP;  There are twostacks, one for data and another for subroutine return addresses.andP;  Each CPUhas a separate 256-byte &quot;base page,&quot; which includes the stacks and 24 bytesof scratchpad area.andM;The instruction set is simple and compact; high code density was a primarydesign goal.andP;  Instructions take from 1 to 7 CPU cycles to execute.andP;  Each CPUcycle is 3 cycles of the system clock, which, in turn, is 2 cycles of theinput clock.andP;  Increment and decrement, for example, take 2 CPU cycles, whileadd and subtract take 4 cycles.andP;  There are no multiply or divideinstructions.andP;  At the 10-MHz maximum input clock, instructions times rangefrom 0.6 to 4.2 [mu]s.andM;For most applications, the CPU architecture should be invisible to theapplication developer.andP;  The language extensions and libraries in NEURON Cmake it possible to develop complete network systems without anyassembly-language programming.andP;  In fact, the initial release of thedevelopment tools will not support assembly language.andM;The 3150 includes 512 bytes of EEPROM.andP;  Eight bytes of the EEPROM areprogrammed by the manufacturer with a unique 48-bit ID and a 16-bitmanufacturer code.andP;  This provides an automatic, guaranteed-unique networkaddress for every NEURON chip ever built.andP;  The remaining 504 bytes storetables for network communications, special classes of data types, andprocessor configuration.andP;  For the 3120, the user program is also stored inthe EEPROM.andP;  The memory can be written up to 10,000 times, and erase andwrite cycles each take 10 ms per byte.andM;While 504 bytes seems like a tiny amount of memory, especially for programswritten in C, many applications will fit.andP;  This is possible because theNEURON chip firmware provides network control and I/O routines in ROM, makinguser programs relatively simple.andP;  Echelon claims that a typical applicationrequires about 100 bytes for configuration tables and 50 to 100 bytes ofprogram.andP;  Examples of applications of this size include light switches andbasic appliance controllers.andM;Systems using the 3150 chip require an external memory to store the firmware,and this same memory (typically EPROM) is used for application software.andP;  The3150's external memory interface provides a 16-bit address space; 6 Kbytesare reserved for internal use, 10 Kbytes are required for Echelon's firmware,and 6 Kbytes are reserved for the debugger and future expansion, leaving 42Kbytes available for the application program.andP;  With a 10-MHz input clock,100-ns memory is required.andM;The 3150 can also be used solely as an intelligent network interface, with astandard microprocessor system (linked to the NEURON chip through shared RAM)executing the application program.andM;The 3120 NEURON chip will add 10 Kbytes of on-chip ROM to store the firmware,eliminating the need for off-chip memory.andP;  Application software can bedownloaded to the EEPROM over the network.andP;  The 3120 does not have anexternal memory interface, so it can be used only for applications whoseprograms fit in the 504 bytes of EEPROM.andP;  Larger application programs mustuse the 3150 with external memory.andM;The 3150 includes 2 Kbytes of SRAM for data storage; the 3120 includes 1Kbytes.andP;  The RAM can be battery-backed when the chip is in standby mode.andP;  TheSRAM stores the stack, application data, system data, and LONTALK packetbuffers and SICBs.andM;I/O Ports and TimersandM;The 3120 and 3150 each provides eleven I/O pins for application-specificfunctions.andP;  Any of the pins can be used as a single-bit input or output port.andO;Inputs can be automatically debounced or latched, and a group of pins can actas a 4- or 8-bit I/O port.andP;  Four of the outputs can sink 20 mA each; theothers can sink 1.4 mA each.andP;  When used as an 8-bit parallel port, data canbe transferred in bursts at speeds up to 1Mbyte/s.andM;An I/O pin can be configured for asynchronous serial I/O at 300, 1200, or2400 bps.andP;  The UART function is implemented in software by the NEURON chipfirmware.andP;  Pairs of pins can be used for clocked serial input or output at 1,10, or 25 kbps.andM;The 3120 has one 16-bit timer/counter, while the 3150 has two.andP;  One of thetimers can use any of four I/O pins as its input, allowing it to performdifferent functions at different times.andP;  The firmware provides routines toimplement a variety of counter/timer functions, which are summarized inTables 2 and 3.andP;  Application developers are spared the complexities ofdealing with the timer hardware directly, and can simply call NEURON Cfunctions to perform the desired operation.andM;The timer's clock rate can be selected for a timer resolution from 0.2[microsec] to 25.6 [microsec], with corresponding maximum times of 13.1 msand 1.7 s.andP;  For pulse-width and pulse-count outputs, the pulse rate rangesfrom 153 Hz to 19.5 kHz.andM;Communications PortandM;The five-bit communications port connects to the network transceiver and hasseveral modes of operation.andP;  &quot;Direct&quot; mode supports both single-ended anddifferential Machester encoding and is used with transceivers such asshort-range RF and twisted-pair.andP;  &quot;Buffered&quot; mode multiplexes data andcommand/status information and is designed for use with intelligenttransceivers, such as for power-line carrier current, that provide their ownmodulation and demodulation.andM;The communications port supports data rates from 9.766 kbits/s to 1.25Mbits/s.andP;  At the maximum 1.25 Mbits/s.andP;  While this is slow compared tonetworks designed for general-purpose computer systems transfering largeamounts of data, network bandwidth is generally not a critical factor in acontrol system.andP;  A more relevant figure of merit is transactions per second.andO;Echelon claims that at 1.5 Mbits/s, the system can perform 500 transactionsper second, each consisting of a message and an acknowledge.andM;NEURON chips on a single circuit board or in a single enclosure can beconnected without transceivers, but most applications require externaltransceivers.andP;  Echelon will provide transceiver boards that operate at 1.25Mbps or 78 kbps over twisted pair, 9600 bps through the power line, and 4883bps on a 49-MHz RF carrier.andM;LONTALK ProtocolandM;LONTALK uses a three-level addressing scheme.andP;  The top level is the domain.andO;The domain ID allows several independent applications, each with a differentdomain ID, to share a common communications medium.andP;  The second level is thesubnet, and the third level is the node.andP;  With up to 127 nodes per subnet and255 subnets per domain, a single domain can have 32,385 nodes.andP;  A node can bea member of two domains, and node group can also be defined.andM;Any node can also be addressed by its 48-bit unique ID programmed by the chipmanufacturer.andP;  This ID is used only during installation and configuration.andM;Nodes exchange data primarily via &quot;network variables.&quot;andP;  Network variables area special class of objects that are declared (using an extension in NEURON C)as either input or output type.andP;  A network variable may be a simple scalarvalue or a C structure up to 31 bytes long.andP;  Input and output variables arelinked when a system is configured.andP;  Whenever an output variable is changed,its value is sent out via the network.andP;  All network nodes that have a linkedinput variable will automatically receive the new value.andM;This mechanism allows data to be exchanged among nodes in a manner that makesthe very existence of the network transparent.andP;  Applications are completelyinsulated from message buffers and other implementation details.andP;  To read avalue from another node, a program simply uses the value of the correspondinginput variable.andP;  This variable will provide the last value that has been sentvia the network.andP;  The &quot;poll&quot; library routine can be called to force thelatest value of all input variables to be updated over the network.andM;Typical network packets, assuming a 5-byte network variable, are 14 byteslong, as follows:andM;* Source Address 2 bytesandM;* Destination Address 2 bytesandM;* Layer 2-5 Headers 3 bytesandM;* CRC 2 bytesandM;* Network Variable Data 5 bytesandM;In addition to network variables, conventional messages can also be sent fromone node to another.andP;  Application messages can be up to 42 bytes long.andM;The protocol provides four types of services for sending network variables ormessages:andM;* ACKD (end-to-end acknowledged).andP;  Individual acknowledge expected from eachreceiver.andM;* REQUEST (request/response).andP;  Individual response (which may include data)expected from each receiver.andM;* UNACK_RPT (unacknowledged repeated).andP;  No response is expected, but messageis sent multiple times.andM;* UNACK (unacknowledged).andP;  No response expected.andM;The first two services are extremely reliable, since the network softwareautomatically retries transmissions if errors occur.andP;  The third service isused when broadcasting to large numbers of nodes, where the volume ofindividual responses would overload the network.andP;  The last service is theleast reliable but uses the least network bandwidth.andM;Messages can also be &quot;authenticated&quot; to prevent unauthorized control of thenetwork.andP;  Authentication is used when a network variable or message has beenspecified as &quot;secure.&quot;andP;  Security, in this case, doesn't mean preventingmessages from being monitored; it means preventing insertion of unauthorizedmessages.andM;Each node stores a 48-bit key that is distributed when the system isinitialized.andP;  When an authenticated message is sent, the receiver transmits arandom data pattern to the sender; this is the authentication &quot;challenge.&quot;andO;The sender performs a transformation on the data using the 48-bit key, andsends the result to the receiver.andP;  The receiver compares the response to itsown transformation of the challenge data.andP;  This allows the receiver to verifythat the sender has the same key, while keeping the key itself secure.andP;  Ifthe sender fails the challenge, the receiver ignores the message.andM;Other Hardware FeaturesandM;The Service pin provides a 50% duty cycle, 76-Hz output that can sink 20 mA;it is intended for driving an LED.andP;  During the 50% of the time that it is notsinking current, the pin operates as an input; if it is grounded, a &quot;serviceevent&quot; is generated.andP;  A service event causes the chip to transmit aspecially-formatted network message containing its 48-bit ID code.andP;  Bygenerating a service event, a node can thus be made to identify itself to anetwork controller.andM;The chip can be put into a &quot;sleep&quot; mode.andP;  In this mode, the clock is stoppedto reduce power consumption, but all state information is retained.andP;  The chiprestarts when a transition occurs on the communications port, a selected I/Opin, or the service pin.andM;A watchdog timer is provided to reset the system in case the software crashesdue to a bug or memory failure.andP;  If software fails to reset the timer within0.84 s (with a 10-MHz clock), the timer resets the chip.andM;Licensing and CompatibilityandM;Echelon plans to maintain a tight reign on the LONWORKS trademark to ensurethat LONWORKS-compatible devices truly interoperate.andP;  The semiconductorvendors are not allowed to produce variants of the chips without Echelon'sapproval.andP;  Echelon is setting up an optional certification process for LONproducts, to be announced early next year, that will set standards for use ofthe compatibility mark.andM;NEURON chips and development tools can be purchased without paying anylicense fees directly.andP;  To buy NEURON chips in volume for inclusion inproducts that are sold to customers, however, an OEM license must bepurchased from Echelon for a one-time fee of $2500.andP;  A royalty of 3% of theNEURON chip purchase price must be paid to Echelon by the chip purchaser.andM;The LONTALK protocol provides the mechanism for data transfer, but it doesnot set policy or define application-specific commands.andP;  Echelon has definedabout 50 standard network variable types (SNVTs, pronounced &quot;snivets&quot;) forcommon applications.andP;  For example, the temperature data type uses a 16-bitsigned value with a resolution of a tenth of a degree per bit.andP;  Echelon willalso serve as a clearing house for vendor-defined network variables.andP;  Intheory, this will allow all certified devices to communicate.andM;ConclusionsandM;The LONWORKS system provides building blocks for low-cost distributed controlsystems.andP;  NEURON chips have the potential to be an extremely high-volumeproduct.andP;  The chips themselves are an essential, but not sufficient, part ofthe solution.andP;  The value of the LONWORKS system is that it not only includeslow-cost chips for network nodes but also includes a powerful, high-leveldevelopment system and a plan for ensuring conformance of all certifiedproducts to compatible protocols and network variables.andM;Because they were specifically designed as node controllers in distributedcontrol systems, the NEURON chips are more effective than standardsingle-chip microcomputers in this application.andP;  The on-chip EEPROM andnetwork interface eliminate the need for external support chips, and theshared-ALU, three-CPU design provides an elegant way to partition the taskswhile keeping costs low.andM;While it isn't a problem today for Echelon's target applications, the futureof the NEURON processor architecture may be limited by its 16-bit addressing.andO;This is a result of Echelon's focus on low cost and compact programs.andP;  Withina few years, on-chip memories larger than the 64-Kbyte address space of theNEURON chip will be affordable.andP;  The history of computers has shown thatprogrammers always find a use for whatever amount of memory is available, andthere is no reason to assume that the NEURON chip will be an exception.andP;  Anugly bank-switched address extension to the architecture to support largerprograms is the likely result.andM;Earlier chips have tried to address some of the same problems, but all havebeen incomplete solutions.andP;  Intel's 8044, for example, provides some of thesame network services as the NEURON chips.andP;  However, it lacks a comparablesoftware development environment, does not include any transceivers, has nostandards effort to ensure that various devices are compatible, and is basedon more expensive chips.andM;There are literally dozens of existing standards for control networks, butnone has the wide range of applicability of the LONWORKS approach.andP;  Echelon'ssophisticated development system and network services built into the NEURONfirmware will make LON applications much easier to develop.andP;  Echelon also hasa significant lead in having two world-class semiconductor manufacturerssigned up to build and market the chips.andM;The CEBus (consumer electronics bus) standard is Echelon's most directcompetitor.andP;  This standard is being developed by the Electronic IndustriesAssociation (EIA), and is not yet finished.andP;  Echelon has participated in theCEBus committees, but the technology adopted for the standard is differentfrom Echelon's.andP;  While CEBus focuses on developing a formal standard ratherthan products, Echelon hopes to set a de facto standard through the successof their chips.andM;Another group called Smart House, sponsored by the building industry, isdeveloping a home automation network.andP;  The oldest home control network is theX-10 system, which is widely available and inexpensive but very limited indata rate and reliability.andM;Some unknowns remain in Echelon's technology.andP;  The chips are challenging tobuild, since they include logic, EEPROM, and analog circuits, and it remainsto be seen how soon Motorola and Toshiba will be in volume production.andO;Transceiver availability is another weak point; only a limited range ofevaluation boards will soon be available.andP;  Echelon is developing a variety oftransceiver products, but these are not as far along as the NEURON chips.andM;If the LONWORKS standard is as successful as Echelon hopes, a visit to thehardware store in a few years will find LONWORKS light switches, outlets,lamps, and appliances, along with a variety of LONWORKS user interfaces andnetwork controllers.andP;  Electronic test equipment, personal computers, andmanufacturing equipment will all be available with LONWORKS interfaces.andO;LONWORKS building blocks will be the standard for building and industrialautomation systems.andP;  The real test of the Echelon approach will be howquickly products using the Echelon chips appear and how easily theycommunicate with each other.andO;</TEXT></DOC>