<?xml version='1.0' encoding='UTF-8'?>
<DOC><DOCNO>  ZF108-064-740  </DOCNO><DOCID>08 064 740.andM;</DOCID><JOURNAL>PC Magazine  Feb 13 1990 v9 n3 p263(12)* Full Text COPYRIGHT Ziff-Davis Publishing Co. 1990.andM;</JOURNAL><TITLE>Protect your data with PCDATA, the data integrity toolkit. (virusdetection and correction program; includes related articles ondownloading program by modem, batch files)(Utilities) (tutorial)</TITLE><AUTHOR>Stiller, Wolfgang.andO;AttFile:   PCMAG\V09N03\PCDATA.EXE;2 Program:  PCDATA.EXE  Self-extracting archive.andM;</AUTHOR><SUMMARY>PCDATA, a virus detection and protection program forIBM-compatible microcomputers, is presented.andP;  PCDATA is acoordinated toolkit consisting of eight assembly-language programsand 19 batch files, each written with built-in help.andP;  The batchfiles drive the programs but do not make use of all theirfunctions.andP;  Initializing the toolkit consists of establishing theinitial integrity of the system; creating a 'rescue' system withbackups of all files; installing the toolkit through a customCHKFILE program; and creating integrity check files.andP;  Booting fromthe PCDATA 'Check' diskette is the easiest way to use it.andP;  PCDATAdetermines whether any changes in data have occurred; the usermust differentiate between authorized changes and those that maysignal corruption.andP;  Instructions for recovering corrupted data andfor customizing the toolkit are given.andM;</SUMMARY><DESCRIPT>Topic:     Computer virusesMicrocomputersData IntegrityData SecurityUtility ProgramsTutorial.andO;Feature:   illustrationprogram.andO;Caption:   CHKFILE: complete listing. (program)andM;</DESCRIPT><TEXT>Protect Your Data with PCDATA, the Data Integrity Toolkit Is your dataprotected against the ravages of a well-written virus?andP;  Or even againstcommon software bugs, hardware failures, and inexplicable glitches?andP;  The factis that PCs have become an essential part of the corporate environment morerapidly than adequate measures have been developed to protect data andexecutables from any of these potentia problems.andP;  Yet who among us can affordto have even a single byte altered on the hard disk he uses at work or athome?andM;To meet the need for protection, I created PCDATA, the PC Magazine DataIntegrity Toolkit.andP;  Unlike the usual single utility presented in this column,PCDATA is a collection (&quot;toolkit&quot;) of coordinated programs and batch files.andO;Working together, they can provide positive assurance that none of yourprograms or data has been damaged in any way.andM;The focus of this article will be on using the toolkit to detect and recoverfrom all data integrity threats, including viruses.andP;  The sidebar &quot;Threats toYour Data&quot; defines and discusses many of the causes of data or programcorruption, such as worms and logic bombs.andP;  The sidebar &quot;Data and ProgramDefense Mechanisms&quot; explores some of the possible protective measures you cantake.andM;ASSESSING THE THREATandM;Today, the risk that ordinary programs will destroy your data is many timesgreater than the threat posed by known computer viruses.andP;  The danger from a&quot;super virus&quot; yet to be developed in more remote in time, but far moreserious.andP;  The most ominous aspect of viruses is that, to date, all of themhave been relatiely primitive in design.andP;  If a method such as that providedby the Data Integrity Toolkit is not widely used, however, a futuresupersophisticated virus could easily infect millions of PCs and then liedormant for some years.andP;  By the time this virus launched its actual attack,it would be too late to stop the havoc it would wreak.andM;The viruses that plague us today have done everything from simply displayingmessages on the screen to making disks unreadable.andP;  One of the less primitiveviruses, the Pakistani &quot;BRAIN&quot; virus, announces its presence by labelinginfected diskettes &quot;BRAIN&quot;.andP;  Since this provides a warning with the very nextDIR or CHK-DSK command, it is clearly deliberately done to limit thedestructive potential of this virus.andP;  Future virus developers may not be sokind!andM;If, from the standpoint of a single PC, a virus is among the least likelythings to corrupt programs or data, is it then acceptable to do nothing or todepend upon techniques that merely make it harder for viruses to infect yoursystem?andP;  Definitely not!andP;  Even a relatively nonmalicious virus or worm cancause you to waste a day--maybe even days--repairing your system.andM;More important, the danger from a virus is only one of a number of riskfactors.andP;  When these other threats to your data are also considered, itbecomes clear that some type of data integrity verification--such as thatprovided by the Data Integrity Toolkit--is required by everyone who valueshis data.andM;THE DATA INTEGRITY TOOLKITandM;The Data Integrity Toolkit consists of eight highly optimized assemblylanguage programs and 19 batch files.andP;  Each program has been written as ageneral-purpose utility and contains built-in help.andP;  The programs run on anyIBM-compatible PC, need only 75K of free memory and require DOS 2.0 or later.andO;The toolkit uses the batch files to drive the programs, but each program hasadditional functions not exploited by the batch files.andP;  The sidebar &quot;The DataIntegrity Toolbox Commands&quot; lists the programs and explains their syntax,while the sidebar &quot;The Batch Files for the Data Integrity Toolbox&quot; provides asimilar treatment for the batch files.andM;The PCDATA programs and batch files can be downloaded in executable form fromPC MagNet, as explained in the sidebar &quot;PCDATA by Modem.&quot;andP;  Due to spaceconsiderations, we are unable to print the source code here.andP;  However, ifyou're interested in examining it, you can download the code as well.andP;  Youcan also get the assembly or BASIC listings by mail or fax by sending awritten request with your name, address and fax number (if applicable) to PCMagazine, Utilities, One Park Avenue, New York, NY 10016; Attention: CarolynFalconer.andP;  No phone calls please.andM;Among the eight programs, three pairs of programs work closely together.andP;  Thefirst pair is CHKFILE.COM and CFCOMP.COM.andP;  CHKFILE reads whatever files arespecified by its first parameter, displays the DOS file date, time, andlength, and then uses separate high-speed algorithms to compute and displaytwo 16-bit check values for each file.andP;  These check values provide acharacteristic signature for each file.andP;  Any change to these files willresult in a different signature.andP;  CHKFILE produces DOS standard output, whichcan be redirected to a file.andP;  CFCOMP ca compare these redirected files andreport exactly which files have been changed, added, or deleted.andM;The second program pair, CHKFILEC.COM and CFCOMPC.COM, work very much likeCHKFILE and CFCOMP.andP;  The diffrence is that the output of CHKFILEC is writtendirectly to a file in a compressed, encrypted, and self-cheecking form.andP;  If asystem glitch should corrupt a CHKFILEC report file, CFCOMPC will detect it.andM;The third pair, CHKBOOT.COM and LODBOOT.COM, check the DOS boot sectors andhard disk partition tables for corruption.andP;  During initialization, CHKBOOTcreates sector reload files and a parameter file that contains check datacalculated for the boot and partition sectors.andP;  All these files containinternal self-check information that will detect any corruption of the filesthemselves.andM;The last two programs, MIRDIR.COM and XALL.COM, were written to facilitatebatch file operation of the toolkit.andP;  MIRDIR allows a batch file to &quot;mirror&quot;the directory structure of one disk onto another.andP;  XALL simply executes aprogram or batch file in all subdirectories.andP;  It is similar to the PCMagazine SWEEP utility, except it runs roughly twice as fast and has specialerror-handling abilities tailored specially for the Data Integrity Toolkit.andM;WORKING TOGETHERandM;The toolkit uses the batch files to drive the programs, although the batchfiles don't exploit and their functions.andP;  SCANMAX.BAT, for example, makes acomplete check of everything on your PC.andP;  Run SCANMAX and CHKBOOT reads theboot and (optionally) the partition sector, calculates the associated checkdata, and compares it with that stored in the parameter file created earlier.andO;If the boot or partition sectors ever become damaged, LODBOOT can be used torestore them by using the associated secto reload file.andM;Next, XALL.COM is used to execute CHKFILEC in all directories of the disk,reading each file and recording its check data.andP;  One report file containingcheck data is written for each directory.andP;  The check data consists of thefilename, check value 1, check value 2, file size, and the DOS time and datestamps.andP;  After comparing the newly created check data with the prior checkdata, CFCOMPC reports any file changes, additions, and deletions.andM;The two check values that are computed by CHKFILEC form the basis fordetecting corruption.andP;  The DOS directory information (file size, time, anddate) alone is not sufficient to detect file damage, since a virus, softwareerror, or hardware error could write directly to disk sectors withoutupdating the DOS file information.andP;  Indeed, one well-known virus trick is tomodify COMMAND.COM with a jump to code that is hidden in its stack area.andO;This produces no discernible change to COMMAND.COM as far as the DOSinformation is concerned.andM;The reason the toolkit records the DOS data at all is to make it easier todifferentiate between legitimate file changes and those caused by some typeof system corruption.andP;  The combination of information recorded in the checkfiles effectively makes it impossible for a virus or a system glitch tomodify a file in a way that can't be detected.andP;  The check files are stored ona floppy so that a virus cannot attack the check information directly.andM;INITIALIZING THE TOOLKIT SYSTEMandM;For simplicity's sake, the instructions that follow assume that you arechecking your hard (fixed) disk C: and that you will be using floppy driveA:.andP;  Ideally, you will want to protect all your drives, but those you bootfrom must receive first priority and are the ones whose partition and bootsectors you will check.andM;The four basic steps that are used to get the Data Integrity Toolkit up andrunning are establishing initial system integrity; creating a rescue system;installing the data integrity toolkit; and initializing the integrity checkfiles.andM;STEP 1: ENSURING SYSTEM INTEGRITYandM;Although the chances are slight, it is always possible that a virus mayalready have infected your system.andP;  On this worst-case assumption, we cannotsafely install the toolkit programs, since the virus can intercept thetoolkit's own BIOS and DOS calls.andP;  We need to begin with as clean a system aspossible.andM;Turn off your PC.andP;  Then turn it on and boot it from a good diskette copy ofDOS.andP;  If there is any chance that this copy could be damaged or infected,take the time to get out your original DOs install disks, execute FORMAT A:/S on a new diskette to make it bootable, and copy the DOS files you normallyuse onto it.andM;Now reinstall DOS from the diskette or compare all its files with those onyour hard disk.andP;  Frankly, to be absolutely sure that your partition and bootsectors are not already infected, you would have to run FORMAT /S and FDISKon your hard disk.andP;  This entails backing up and then restoring all your(probably uninfected) files, of course, and it's probably not worth thetrouble unless you actually have some indication of infection (such as avolume labeled BRAIN).andM;If there is evidence of infection, one alternative would be to locate anoninfected hard disk with the same DOS version and use CHKBOOT to comparethe boot sectors of the two machines.andP;  If CHKBOOT shows the sectors to be OK,then all is well.andP;  Otherwise the sector file--@@BOOT.SCT--and optinally@@PARTIT.SCT--will have to be copied from the clean system to the suspectone.andP;  After booting the suspect PC from a clean floppy, LODBOOT can be usedto reload the suspect sectors.andM;Now change to the drive you want to check--in this sexample, drive C:--andexecute CHKDSK to detect and correct any directory or FAT problems.andM;STEP 2: CREATE A RESCUE SYSTEMandM;In case a virus ever does attack your PC, or if a glitch damages an importantfile, it is vital to ensure that you can get your PC up and running so thatyou can undertake the necessary repairs.andP;  The rescue system created in thisstep will give you the assurance that no matter what happens, you can boot ahealthy system and recover whatever has been damaged.andM;Make sure, of course, that you have adequate backups to all files.andP;  Alwayssave your original program install diskettes and their backups.andP;  And onlycopy programs from your install disks; otherwise they, too, could becomeinfected by a virus.andP;  But most important, decide on a backup policy andfollow it!andP;  Having two full backups of all files on your hard disk is minimalacceptable insurance.andP;  Then, by doing regular incremental backups (onlymodified files), it will be a relatively painless task to recover fully fromany type of failure.andP;  Be sure, too, that you have a robust backup and restoreprogram--one that can tolerate a disk error without aborting the entirerestore.andM;Create three bootable floppies for the toolkit files using your clean copy ofDOS.andP;  Make one of these of the highest capacity your drives support and labelit Check.andP;  Label the other two Recovery and Diagnose respectively.andM;An important warning: never put your PCDATA (toolkit) diskettes in a driveunless you are about to boot from one of them.andP;  A virus could contaminate thediskettes even though--supposedly--no program is using them.andP;  The PakistaniBRAIN virus has just this capability, for example.andM;Copy your disk restore program to the diskette labeled Recovery.andP;  It'shelpful to copy your backup log to this diskette as well, since you will useit to recover from a disk failure or a virus attack.andP;  If your backup programdoes not maintain a backup log, it's worthwhile to use a text editor andcreate one; just jot a note every time you do a full or partial backup.andO;You'll also need 70K of free space on this disk.andP;  If you don't have it, use ahigher-capacity diskette or create an additional one.andM;Copy your diagnostic and disk utility programs to the Diagnose diskette.andO;This will provide a safe way to run hardware tests on a system that may beinfected with a virus.andM;STEP 3: INSTALLING THE TOOLKITandM;This step customizes and installs the PCDATA software on the Recovery andCheck diskettes that will be used to test the integrity of the primary bootdisk and to recover from problems that may arise.andM;If you use a hard disk, copy the toolkit files into a subdirectory of thedrive from which you normally boot--the most important drive to check.andP;  Thenchange to this directory and verify that you have a valid set of files byexecuting the commandandM;CHKFILE *.*andM;If your machine lacks a hard disk, copy the toolkit files to a subdirectoryon the Check diskette.andP;  If the report on your screen matches the one shown inFigure 1, you have all the files, and their check values and sizes arecorrect.andP;  Next, copy CHKDSK.COM and MORE.COM from your original DOS disk ontoboth your Check and Recovery diskettes.andM;Return now to your toolkit directory.andP;  The vast majority of you will probablybe protecting a system with a hard disk.andP;  But if you do not have a hard diskon your PC, put the check disk in drive A: and the Recovery disk in drive B:and executeandM;SETUPF A: B:andM;You can do this even on systems that have only one floppy drive.andP;  In thiscase, DOS will pretend that there is a drive B: and tell you when to insertthe disks that would normally be put into it.andP;  If you have just one drive,however, do your disk swaps only when DOS tells you to, rather than when thebatch file requests a swap.andM;If you have one or more physical drives and your system boots from the first,put the Recovery disk in drive A: and execute the commandandM;SETUPH A:andM;If your system boots from a second physical hard disk, enterandM;SETUPH2 A:andM;These batch files will use CHKBOOT to check your current boot and partitionsectors and create parameter and reload files.andP;  The messageandM;Partition sector nor processed.andP;  Hard disk not found.andM;is normal for systems that have no hard disk.andP;  The sector reload files andall other needed toolkit files will be copied to the Recovery diskette.andM;The batch file will now instruct you to insert the Check diskette.andP;  TheCHKBOOT parameter file and other needed files will be copied to it.andP;  Thesebatch files include a step that checks the files copied to the Recovery andCheck diskettes to make sure of their integrity.andP;  You should not see any DataIntegrity Toolkit files listed as deleted or changed.andP;  It is normal, however,for the sector files (@@BOOT.SCT and @@PARTIT.SCT), CHKBOOT.PRM, COMMAND.COM,MORE.COM, CHKDSK.COM, and the two system files (IBMBIO.COM And IBMDOS.COM) tobe reported as changed at this point.andP;  (On non-IBM versions of DOS, thesystem files will have different names.)andM;If any of the toolkit files are reported as deleted, check that you haveenough room on your diskette and that all the copies work.andP;  The messageandM;File totals UnequalandM;is normal.andM;If the disk to be checked has more than 5,000 file sor 85 directories, youwill probably run out of space using a normal (DSDD) 360K disk as your Checkdiskette.andP;  Using a higher-capacity diskette is the best solution.andP;  A 720Kdiskette will accommodate 10,000 files and 300 directories, with room tospare.andP;  If this still isn't enough, you can create an additional Checkdiskette.andP;  By not putting the toolkit files and DOS on the additional disk,you'll gain an extra 124K of space.andM;Since this second Check diskette is nonbootable, you can put it in adifferent physical drive than you use for your normal Check diskette.andP;  Labelthis one &quot;Check-mt&quot; (&quot;mt&quot; for &quot;empty&quot;) and copy DELFILES.BAT from yourtoolkit file onto it.andP;  If you are going to employ it to check a bootabledrive on your hard disk, copy CHKBOOT.PRM to it from your regular Checkdiskette as well.andM;A 360K Check-mt diskette will handle 5,000 files and 150 directories.andP;  Notethat in order to use Check-mt diskettes, you must execute FASTRUN.BAT beforerunning SCANMAX or SCANSYS (which performs only the file checking).andM;The AUTOEXEC.BAT files and the CONFIG.SYS files should not be necessary onany of the PCDATA diskettes unless your system must run customizing files,such as special device drivers, at boot-up.andP;  Be extremely careful not to addany TSRs or directories to your path.andP;  It is absolutely vital that nounforeseen programs execute during the integrity check.andM;You may wish to add a routine check of the boot sectors to your normalAUTOEXEC.BAT file.andP;  To add this optional bit of extra security, use an ASCIIeditor or word processor and typeandM;CHKBOOT /B /PandM;in your AUTOEXEC.BAT file.andP;  Use /2 rather than /P if you boot from a secondphysical drive.andP;  Copy CHKBOOT.PRM to the same root directory as your normalAUTOEXEC.BAT file or use the CHKBOOT filespec parameter if you want tospecify another file.andP;  Although this added precaution will not catch allboot-record infections, it will provide early warning of the moresimple-minded viruses and immediate detection of all other types ofcorruption.andM;STEP 4: THE INTEGRITY CHECK FILESandM;It's now time to create the actual information that the toolkit will need toconfirm the consistent state of your system or to report any anomalies.andP;  Inorder to check your hard disk drive C: (per our example), make sure that ithas at least 75K of free disk space, put the Check diskette into drive A:,and enter the following:andM;FASTRUN A:andM;FASTRUN creates a directory called ))PCITK.TMP on drive C: and then it copiesall the program that it needs (including COMMAND.COM) from the Check disketteto this directory.andP;  FASTRUN also sets the DOS PATH and the COMSPEC to usefiles only from this directory.andP;  Loading programs and batch files from thisdirectory will be much faster than if you load them from a floppy.andP;  If youhave created a Check-mt diskette, insert it in drive A: at this point andenterandM;INITSYS A:andM;If you have chosen not to use FASTRUN, executeandM;A: INITSYS A:andM;with the Check-mt diskette in drive A:andM;INITSYS uses XALL to execute the programs MIRDIR and CHKFILEC in alldirectories.andP;  MIRDIR creates a directory on the floppy diskette with the samename as the one being checked.andP;  CHKFILEC then reads each file in the harddisk directory and writes a compressed report file (containing the calculatedcheck information) in the corresponding diskette directory.andP;  If FASTRUN wasexecuted, INITSYS will delete the ))PCITK.TMP directory and its files whenit's through.andM;MAKING ADDITIONAL CHECK DISKETTESandM;For each additional hard disk drive you intend to check, create another Checkdiskette.andP;  Execute FORMAT A:/S on each additional diskette and copy all .COMand .BAT files from the original Check diskette to each of these disks.andP;  Ifany of the additional drives are bootable, format two new disks for each(using FORMAT A:/S) and create new Recover and Check diskettes for each ofthem as well--just as you previously did for drive C:.andP;  Clearly label thediskettes you have created, with the type (Check or Recovery) and the name ofthe drive on which they will be used.andM;RUNNING THE TOOLKITandM;The most direct way to use PCDATA is to boot from the Check diskette andthen, at regular intervals, to run either SCANMAX or SCANSYS.andP;  These batchfiles will use only programs from the floppy diskette, so as virus can'tinterfere with the integrity-checking process.andM;SCANMAX will do a CHKDSK /F to make sure the basic FAT and directorystructure is sound.andP;  If CHKDSK does report a problem, don't worry!andP;  SCANMAXwill shortly report exactly what has been added, deleted, or changed, and youwill be given the opinion of allowing the file to fix it.andM;SCANMAX next invokes CHKBOOT to determine whether your boot record andpartition sectors are undamaged.andP;  SCANMAX then uses XALL and CHKFILEC to readevery file on your hard disk and uses CFCOMPC to compare it to the recordedfile integrity information.andM;The completed report will be written to a file called ))SYS.LOG in the rootdirectory of the drive being checked.andP;  IF any files have been changed, theupdated report file will be written to the corresponding directory on theCheck floppy diskette.andP;  You can use your favorite file viewer, text editor,or the batch file DSPREP to display the results of the integrity check.andM;You will see a listing of any files or directories that have been added,deleted, or changed.andP;  If a file has been changed, both the old and the newinformation for that file will be displayed.andP;  This allows a comparison todetermine whether the file change was due to some type of corruption orwhether it was the result of legitimate operations.andM;EVALUATING SYSTEM CHANGESandM;How can you differentiate between good (authorized) and bad changes?andP;  First,of course, only those files that are meant to be modified by the programs youuse should show up as changed.andP;  Finding that any other files have beenchanged, added, or deleted is a sign of potential corruption.andP;  Most programsmake it pretty clear which files they are going to modify, though manyprograms also update directory, index, parameter, temporary, or backup filesthat may not be explicitly mentioned in the documentation.andP;  These files areusually recognizable by their file extensions; for example, .BAK for backupfiles, and so forth.andM;Any change to a .COM, .EXE, .BIN, .OBJ, .OVL, .LIB, .BAT, or .SYS file shouldbe examined very carefully: these are the files (in addition to the boot orpartition sectors) that a virus would attack.andP;  Even if a hardware or softwareglitch (rather than a virus) causes the changes to these files, you probablystill would not want to run them.andP;  You should note, however, that duringinstallation or a change of options, many programs will legitimately modifythe executable program itself (the .COM or .EXE file) rather than a parameterfile.andP;  So, if you have run an INSTALL or CHANGE OPTIONS program, don't beunduly alarmed if you see an executable file listed as modified.andM;Be especially vigilant when it comes to DOS-related files, however.andP;  If anyof these are changed, you've got a potentially serious problem.andP;  It's a goodbet you've got some type of system corruption and perhaps even a virus.andO;Another serious sympton is if CFCOMPC shows that a file has changed, yet theDOS file date and time have not changed.andP;  This is important because itindicates that something has bypassed DOS to update the file.andP;  The causecould be a system glitch that caused a stray write to that file or someone&quot;playing&quot; with a sector editor such as Norton's NU.andP;  But it could alsoindicate the presence of hostile software.andM;Whenever you run CHKDSK, you should also keep an eye on the number of bytesin bad sectors.andP;  This should not spontaneously increase.andP;  Viruses frequentlyhide their code in bad sectors so they can modify a program withoutincreasing its size.andM;CHECKING INDIVIDUAL DIRECTORIESandM;SCANDIR.BAT examines changes in the current directory.andP;  Run at intervals, itreduces the size of the report produced by SCANMAX or SCANSYS.andM;When adding a new directory, run SCANDIR to update the check data on yourCheck diskette quickly.andP;  Rather than writing the results of the comparison to))SUS.LOG, SCANDIR displays changes on the screen and pauses foracknowledgement.andP;  To check the current directory (drive C:) without FASTRUN,boot from the Check diskette in drive A: and enterandM;A:SCANDIR A:andM;Alternately, you could executeandM;FASTRUN A: SCANDIR A:andM;Unlike SCANMAX and SCANSYS, SCANDIR does not delete the directory created byFASTRUN, so SCANDIR can be repeated more than once without repeating FASTRUN.andM;CHECKING INDIVIDUAL FILESandM;CHECK.BAT can be used to check individual files or groups of files.andP;  Forexample, if you just changed several batch files, the commandandM;CHECK *.BAT A:andM;will tell you which ones have been altered.andP;  Again, drive A: must be holdingyour Check or Check-mt diskette.andP;  Unlike SCANMAX, SCANSYS, and SCANDIR, CHECKwill not update the information recorded on the Check diskette.andM;THE ROAD TO RECOVERYandM;Once the Data Integrity Toolkit has detected what looks like corruption, whatshould you do about it?andP;  Here is a detailed method for recovering from datacorruption, whethr caused by a virus, a program bug, or something else.andP;  Onceagain, to simplify the description, the commands presented will assume thatyou are trying to recover drive C: and that the floppy drive you are using isA:andM;First, write down whatever indication(s) of corruption you have.andP;  Record anyevents leading up to the failure.andP;  What programs did you run?andP;  Whatmemory-resident (TSR) programs were loaded?andP;  Did these programs completesuccessfully?andP;  Were there any strange error mssages or any unusual behaviorby any program?andP;  Note these things now, while they are fresh on your mind.andM;Next, to be absolutely certain that there is no corrupted code resident inmemory, power down your PC and boot it up from the Recovery diskette.andP;  Fornow, all programs you execute should come from this diskette.andP;  Unless you aresure you are not dealing with a virus, don't execute anything from any diskthat has been used on the affected PC.andP;  You should be looking at the A:prompt.andM;If there is damage to the partition sector, executeandM;LODBOOT /PandM;to restore the original partition sector.andP;  Use /2 rather than /P if you bootfrom the second physical drive.andM;If there is damage to the DOS boot sector, change to the drive (in this case,C:) with the bad boot sector (your Recovery disk is still in drive A:) andenterandM;RELODB A:andM;RELODB will copy @@BOOT.SCT to the drive containing the corrupted boot sectorand immediately execute LODBOOT /B to reload the boot sector.andM;If you haven't run a full SCANMAX, run it now.andP;  This will give you a fullreport of what has been corrupted, and if SCANMAX runs without any diskerrors, the disk is probably not very sick.andP;  If there is any indication of acontinuing hardware problem, that must be resolved first.andP;  Run whateverdiagnostics you have on your Diagnose diskette and fix any hardware problemsbefore proceeding any further.andP;  There's no point in reloading the files ontoa disk that will shortly fail again.andM;If you encounter an unreadable file, it may be worth trying one of theutility programs such as Norton's DT.andP;  After apparently recovering the file,run CHECK against that file to verify that it is intact.andP;  I have never beenable to successfully recover a file with a bad sector using any of theavailable utility programs, so you must be sure to verify the file'sintegrity.andM;Up to this point we have eliminated all system-wide problem sources.andP;  Thereport in ))SYS.LOG should make it clear which files are corrupted.andP;  Thus,we're now ready to reload these files from a backup disk.andP;  After doing so,it's worthwhile to run CHKFILE against the just-restored files.andP;  The checkinformation from these files can be compared with that recorded in ))SYS.LOG.andO;If your ))A.LOG files were also backed up, you can simply run a SCANDIR todtermine whether the files were successfully restored.andM;Now that you've recovered your files and reestablished system integrity, tryto determine what initially caused the corruption.andP;  If your best guess is ahardware glitch, run some diagnostic programs for a good long time.andP;  Thereason for this is that many hardware problems are intermittent.andP;  It may takea while to shake them out again or it may take a special circumstance, suchas a cold or a hot computer.andP;  Are all boards and connectors seated firmly?andM;If your best guess is a software glitch, keep a close eye on the programsthat were run prior to the appearance of the proglem.andP;  Run SCANSYS frequentlybefore and after running the suspect programs.andM;If there is any chance that the corruption may have been causd by malicioussoftware, then try to re-create the problem.andP;  Check with other users to seeif they have encountered the same difficulty.andP;  Compare the check valuescalculated by CHKFILE for the suspect programs with those that other usershave for the same programs.andP;  It is possible that you have a corrupted versionof an otherwise innocent program.andM;CUSTOMIZING PCDATAandM;The batch files that drive the toolkit programs can easily be customized tomeet your specific needs.andP;  Many users may find that adding the /O parameterto CFCOMPC in SCANRFDR.BAT is desirable.andP;  By adding this parameter, you willnot be notified of a change if the file is the same but only the DOS time anddate stamps have changed.andP;  If you have programs that rewrite files withoutchanging them, this will eliminate unnecessary messages.andM;If you can spare 80K and put your toolkit programs on your RAMdisk, this willspeed their execution.andP;  Just run FASTRUN.BAT and let it copy everything.andP;  Ifyou can't afford quite so much RAM, modify SCANRFDR.BAT so that file ))B.LOGis written to and deleted from the RAMdisk.andP;  Then modify FASTRUN.BAT to copyat least SCANRFDR.BAT, CHKFILEC.COM, MIRDIR.COM, and CFCOMPC.COM to theRAMdisk.andP;  This requires only 24K.andP;  Then modify the statementandM;PATH=/))PCITK.TMPandM;to include your RAMdisk.andP;  For example, you would useandM;PATH=E:/;/))PCITK.TMPandM;if your RAMdisk is drive E:andM;The Data Integrity Toolkit will detect all viruses, even those that might bewritten to circumvent it.andP;  If you are willing to trade protection forconvenience, you may wish to use the &quot;D&quot; batch files: CHECK.BAT,SCANSYSD.BAT, and SCANDIRD.BAT.andP;  These batch files put the report (.LOG)files into each directory on the disk or drive being checked rather than in aseparate directory on a floppy.andP;  This increases the convenience of runningthe Toolkit, but exposes you to the threat that someone might write a virusthat infects a program and then locates and modifies the associated .LOGfile.andP;  In such a case, the change to the file would be detected.andM;In order to use the &quot;D&quot; batch files, SCANRFDR.BAT, SCANDIR.BAT, SCANSYS.BAT,CHKFILEC.COM, CFCOMPC.COM, XALL.COM, and MIRDIR.COM must be in a directorythat's on your path.andP;  These files could also be placed on a RAMdisk, as justdescribed.andM;It's a very good idea to change the names used for the report files.andP;  Bydefault, they're called ))A.LOG.andP;  The name can be anything, but it must beginwith two characters that are not used this way anywhere else on your system.andO;If you change the )) prefix, you must also change the /I:)) parameter forCHKFILEC in SCANRFDR.BAT so that it will ignore files beginning with the twonew characters.andP;  You may also want to include the /1 and/or the /2 parameteron CHKFILEC.andP;  This will cause your version of the toolkit to use a differentalgorithm than the standard.andP;  This makes it a little more difficult for aperson or a program to corrupt your system in a way that can't be detected.andM;DESIGN AND PROGRAMMING ISSUESandM;The PC Magazine Data Integrity Toolkit was developed with two goals in mind.andO;First, it had to be able to detect any type of system corruption, even thatcaused by a sophisticated virus.andP;  Second, it had to be practical to run oneven the slowest PCs.andM;Toward the first goal, it was vital to make sure that if a toolkit reportfile should become corrupted, the toolkit would not mistakenly report changesin unchanged files.andP;  For this reason, all files generated by the toolkitcarry internal self-check information.andP;  Any damage to these files will bedetected whenever they are processed.andP;  An exception to this is CHKFILE'soutput.andP;  Since this is formatted for display, it has only partialself-checking capability.andP;  That is one of the reasons the toolkit utilizesCHKFILEC rather than CHKFILE as its file-checking engine.andM;The second goal translate into two important characteristics: speed and size.andO;The programs must be fast and small, and they should run quickly on even theleast powerful systems.andM;The algorithms chosen to generate the check data were selected because theyexecute quickly on 80x86 processors.andP;  Parameters that determine how theprograms work, such as /1 and /2 for CHKFILE and CHKFILEC, directly modifythe executable code.andP;  This programming technique is ordinarily frowned upon,but it is appropriate here, since the affected code is in the most frequentlyexecuted loop of the program.andP;  By modifying the instructions directly, weeliminate the need to check a flag constantly, and still we provide maximumflexibility to the user.andM;The CFCOMP and CFCOMPC programs utilize this technique with their /Oparameter.andP;  This parameter allows the user to see only files that have reallychanged, not files that are identical except for different DOS time and datestamps.andM;Both speed and small size become an important factor in designing the memorymanagement necessary for CFCOMP and CFCOMPC.andP;  Both programs must read andcompare two report files.andP;  Each of the programs tries to allocate a 128Kbuffer for these files.andP;  This maximizes speed, but what if the PC does nothave this much memory?andP;  It in this case, the programs will reissue the memoryallocation request for the maximum amount of memory available and will usethat.andP;  This provides maximum flexibility and speed, while still running onsmall systems.andM;The toolkit programs have been optimized for fast execution on the slowerPCs, but they really fly on 80286 and 80386 PCs.andP;  Where possible,word-oriented instructions were utilized (for example, MOVSW rather thanMOVSB) in order to optimize performance on machines that have a real 16-bitdata path.andP;  On a standard IBM PS/2 Model 50Z with a 32MB hard disk (using30MB in 915 files), SCANMAX ran in 7 minutes 15 seconds.andM;The programs put their intialization code in the file buffer area.andP;  This isthe code that interprets the parameters you enter for each program, performsany required program customization, and (optionally) opens the files.andP;  Again,this technique is somewhat nonstandard, but the memory it saves issignificant.andP;  In CHKFILEC, for example, the initialization code is twice aslarge as the rest of the program.andM;All Data Integrity Toolkit programs return DOS ERRORLEVEL codes so that theycan be driven effectively by batch files.andP;  If they execute normally, theyreturn a zero ERRORLEVEL.andP;  The higher the ERRORLEVEL returned by the program,the more severe the condition that occurred.andP;  Invalid syntax will alwaysreturn the highest ERRORLEVEL and will produce a display of the correctsyntax.andP;  Most serious errors, such as input/output errors, will also causethe program to beep and prompt the user to hit a key.andP;  This prevents anyserious errors from being overlooked when the programs are driven by batchfiles.andM;A DAUNTING PROCESS?andM;At first flance the processes I've described here may seem rather involved.andO;Don't be discouraged, though.andP;  Most of the steps outlined above center aroundsetting up the system and initializing the toolkit files that provide theinformation necessary to maintain a stable system.andP;  Once over this hurdle,the process simply become one of running SCANMAX at regular intervals.andM;In the best of all possible worlds, SCANMAX would always report that nothingis amiss.andP;  But should a glitch or some foreign agent cause your systemssuddenly to spin out of balance, you will know it and be able to takeimmediate action.andP;  In the real world, that's how to survive.andM;Wolfgang Stiller is the systems programming administrator for the FloridaDepartment of Labor and an independent developer of PC software.andP;  Hespecializes in computer security.andO;</TEXT></DOC>