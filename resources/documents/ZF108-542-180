<?xml version='1.0' encoding='UTF-8'?>
<DOC><DOCNO>  ZF108-542-180  </DOCNO><DOCID>08 542 180.andM;</DOCID><JOURNAL>PC Magazine  June 26 1990 v9 n12 p455(3)* Full Text COPYRIGHT Ziff-Davis Publishing Co. 1990.andM;</JOURNAL><TITLE>Tutor.andO;</TITLE><AUTHOR>Prosise, Jeff.andM;</AUTHOR><DESCRIPT>Feature:   illustrationtableprogram.andO;Caption:   Format of the boot sector. (table)Sample listings. (program)andM;</DESCRIPT><TEXT>TutorandM;Reinitializing disksandM;While poking around on a bunch of old floppy disks with DEBUG, I discoveredthat each different formatting program I've used in the past--DOS'sFORMAT.COM, The Norton Utilities' Safe Format, and PC Tools Deluxe's PCFormat, to name a few--places an ASCII identifier in the first sector of thedisk.andP;  A disk formatted with MS-DOS 3.3 contains the string &quot;MSDOS3.3,&quot; adisk formatted with Safe Disk &quot;IBM PNCI,&quot; and a disk formatted with PC Format&quot;PCFormat&quot;.andM;What's the significance of these character strings?andP;  What else is there ofinterest in the first sector of a disk?andP;  And finally, is there a differencein the way FORMAT.COM, Safe Disk, and PC Format initialize disks?andM;Larry L. Feickert Sioux Falls, South DakotaandM;The first logical sector of a DOS disk is known as the boot sector.andP;  It isused by DOS to store information about the media type and the structure ofthe file system the disk was fomatted for.andP;  It also contains the bootstrapcode that DOS used to load itself from disk during start-up.andM;Figure 1 shows the format of the boot sector.andP;  The first 3 bytes contain amachine language JMP instruction that transfers control to DOS'sbootstrapping code.andP;  The values found there will always be E9h (the opcodefor an intrasegment jump) followed by a 16-bit displacement, or EBh (a shortjump) followed by an 8-bit displacement and an NOP instruction (90h).andP;  Whenthe disk is used for start-up, the PC's ROM-based bootstrap loader reads thefirst sector into the computer's memory and executes the JMP instruction toinitiate the bootstrapping process.andM;The 8 bytes at offset 03h in the boot sector are reserved for the name of theprogram or operating system that formatted the disk.andP;  Traditionally, theformatting utility writes an ASCII character string to this slot thatidentifies the brand and version number of the operating system.andM;The area spanning the range from offsets 0Bh through 17h is known as the BIOSParameter Block, or BPB.andP;  The BPB holds everything DOS needs to know aboutthe formatted structure of the disk: the number of bytes per sector, numberof sectors per cluster, number of reserved sectors, number of copies of thefile allocation table (FAT), number of root directory entries, number ofsectors, the media descriptor byte, and the size of the FAT in sectors.andM;Offsets 18h through 1Dh hold information about the physical makeup of thedisk: the number of sectors per track, the number of heads or sides, and thenumber of hidden sectors.andP;  DOS 4.0 assigns meaning to the ensuing 32 bytes aswell--2 bytes to form the high word of a 4-byte hidden sector count, 4 forthe number of total sectors, 1 to record the physical drive number, 1reserved, 1 for the extended boot record signature, 4 for the serial number,11 for the volume label (stored as a root directory entry in previousversions of DOS), and 8 reserved for unspecified uses at the end.andM;In DOS 4.0, two of the fields--the sector count at offset 13h and the sectorcount at offset 20h--are redundant.andP;  The first field is 1 word long and usedon formatted volumes less than 32MB in size, and the second is 2 words longand filled in only on large (greater than 32MB) volumes.andP;  Earlier versions ofDOS, which did not support large volume sizes, used the entry at offset 13hexclusively.andM;The bootstrap code may start anywhere from offset 1Eh onward, depending onwhat version of DOS you're using.andP;  The job of the short program containedthere is a daunting one.andP;  It loads the operating system from disk and getsthe machine started using a length of code consisting of no more than 512bytes (the length of one sector) minus the length of the BPB and other systemareas.andP;  Suffice it to say that this limitation on code length is the primaryreason DOS imposes the restriction on system disks that the directory entriesfor the system files IBMBIO.COM and IBMDOS.COM (or IO.SYS and MSDOS.SYS) belocated in the first two slots of the root directory and that IBMBIO.COM bestored in contiguous sectors starting with the first cluster.andM;If you're interested in exploring the bootstrap loader further and arecomfortable with DEBUG, insert a system-formatted floppy disk into drive A:,start DEBUG, and type L 0 0 0 1 to load the boot sector into memory at offset00h.andP;  Then type U 0 and resume tracing through the code at the addresstargeted by the unassembled JMP instruction.andM;Do FORMAT.COM, Safe Format, and PC Format format disks the same way?andP;  Appliedto a new, never-before-formatted floppy disk, yes: each one initializes theboot sector, two copies of the FAT, the root directory, and the portion ofthe disk where file data is stored using nearly identical methods.andM;But how these utilities format disks that have been previously formattedvaries substantially.andP;  FORMAT.COM treats a pre-formatted disk the same as itdoes a new one, completely reinitializing it from start to finish, and in theprocess, rendering any existing data on the disk unrecoverable.andP;  Safe Formatand PC Format, by contrast preserve data on a preformatted disk by sim plyerasing existing files rather than overwriting them.andP;  The result: sinceerased files can be restored using any one of a number of unerase utilities,files on disks formatted with Safe Format or PC Format can be successfullyrecovered after an accidental format.andM;The sector maps in Figure 2 illustrate why.andP;  Figure 2(a) shows a DEBUG-typehex dump of selected portions of the boot sector, FAT, root directory, anddata area of a freshly formatted 360K disk containing two files--COVER.DOCand CONTACTS.DOC.andP;  The disk was formatted with PC-DOS 3.3's FORMAT.COM.andP;  TheOEM identification field in the boot sector bears DOS's identifying mark,while the FAT and root directory contain entries for the two files and thedata area holds the actual bytes that make them up.andM;Figure 2(b) shows the same areas after the disk is reformatted withFORMAT.COM.andP;  The FAT, root directory, and data area have been reinitialized.andO;The root directory, which previously held filename entries for COVER.DOC andCONTACTS.DOC, now holds all zeros.andP;  And all bytes in the data area have beenreplaced with the value F6h.andM;Figures 2(c) and 2(d) show what the disk would look like had it beenreformatted with Safe Format and PC Format, respectively, using eachutility's default formatting parameters.andP;  Both programs reinitialize the bootsector (as evidenced by the strings &quot;IBM PNCI&quot; and &quot;PCFormat&quot; in the bootsector) and the FAT, but leave the root directory and data area largelyintact.andP;  Rather than destroy files the way FORMAT.COM does, Safe Format andPC Format erase them by replacing the first character in each filename withE5h and zeroing the corresponding entries in the FAT.andP;  For all outwardappearances, the root directory is just as empty as on the disk reformattedwith FORMAT.COM.andP;  But the original files on the disk reformatted with SafeFormat or PC Format still reside physically on the surface of the disk wherethey can be recovered should the need arise.andP;  Those on the disk reformattedwith FORMAT.COM cannot.andM;Another reason to use a smart formatting utility--one that leaves the rootdirectory and data areas intact on a disk that isn't being formatted fromscratch--is that it allows the formatting process to proceed much faster.andO;Safe Format and PC Format format preformatted disks much faster thanFORMAT.COM.andP;  Both programs also offer additional quick-formatting options,which not only speed the format up further, but leave even more of theoriginal contents of the disk intact.andP;  Safe Disk's Quick Format option, forexample, leaves the contents of the boot sector unmodified, working only inthe FAT and root directory.andP;  PC Format's/Q option does the same.andM;ASK THE TUTORandM;The Tutor solves practical problems and explains points of general interestabout using your hardware and software more productively.andP;  Questions aboutDOS and systems in general are also answered.andP;  Send your questions to Tutor,PC Magazine, One Park Avenue, New York, NY 10016, or upload them to PC MagNet(see the &quot;By Modem&quot; sidebar in the Utilities column).andP;  We're sorry, but wecannot answer questions personally.andO;</TEXT></DOC>