<?xml version='1.0' encoding='UTF-8'?>
<DOC><DOCNO> ZF32-069-086 </DOCNO><DOCID>11 203 313</DOCID><JOURNAL>Data Based Advisor  Sept 1991 v9 n9 p38(3)* Full Text COPYRIGHT Data Based Solutions 1991.andM;</JOURNAL><TITLE>More valid routines. (Mac Rubel's Power Tools) (tutorial)</TITLE><AUTHOR>Rubel, Malcolm C.andM;</AUTHOR><SUMMARY>Programmers interested in solving data-entry validation problemswith the VALID clause with GETs in database management systemprogramming need to be aware of several possible problems.andP;  Thebasic X-Base READ will cause programmers problems if they are notcareful, because users can exit a READ in a variety of ways thatcan have undesirable results.andP;  Numerous examples using Foxpro andClipper are presented to illustrate how dialects react.andP;  It isalso important for programmers to be aware of the generaloperating qualities of a program before engaging in complexprogramming, so that the correct techniques are used to avoidprogramming problems.andM;</SUMMARY><DESCRIPT>Topic:     Program Development TechniquesFunctional CapabilitiesGuidelinesApplications ProgrammingData Base Management Systems.andM;</DESCRIPT><TEXT>If it seems that you can solve all your data-entry validation problems usingthe VALID clause with your GETs, think again.andP;  VALIDs have several problemsthat we need to discuss before going to any further.andM;The standard X-Base READ will cause you many untold problems if you're notcareful.andP;  Users can exit a READ in many ways, several of which haveundesirable consequences.andP;  VALIDs attached to a GET may or may not getprocessed when you move over a GET or leave a READ.andP;  For an example, take alook at the code in Listing 1.andM;Listing 1--VALID testing codeandM;aa = 'a' bb = 'b' cc = 'c' clear @ 2,2 GET aa @ 3,2 GET bb VALID msdw() @ 4,2GET cc READandM;This code is for discussion's sake only.andP;  It's ridiculously simple so you cansee what happens under different circumstances using different products.andM;How dialects reactandM;First, look at dBASE IV 1.1.andP;  If you press the Enter key three times, you'llskip down through the three GETs, and the READ will end without VALIDatingthe second variable.andP;  To follow up on this, the same is true if you press thedown arrow key three times or the up or left arrow, PgDn, PgUp, or Esc keysonce.andM;In fact, the VALID is only processed when users enter something in a fieldthat has an attached VALID clause.andP;  Skipping over the GET doesn't activatethe VALID.andP;  Ashton-Tate must have been aware of this problem, because indBASE IV 1.1 they added the REQUIRED option to VALID.andP;  When you add theREQUIRED modifier to the VALID clause, the VALID executes when you try tomove over the field with either the Enter or the arrow keys.andP;  Entering &quot;VALIDREQUIRED msdw()&quot; ensures that the VALID executes when users pass through thatspecific get.andP;  The VALID isn't executed when users press the PgDn or Esc keysto exit the READ.andM;FoxPro, dBXL, and Clipper act in different manner.andP;  VALID executes all theexception cases listed above except when users press the Esc or PgDn keybefore starting with the second field.andP;  These dialects don't need theREQUIRED option, since they act by default.andP;  As with dBASE IV, the VALIDdoesn't execute if users never get to the GET.andP;  If users press the Esc, PgUp,or PgDn key, the VALID isn't executed.andM;Listing 2--More VALID codeandM;name = 'Bill Jones' level = 4 salary = 40000 bonus = .1500 department ='Sales'andM;@ 2,2 GET name PICTURE 'XXXXXXXXXXXXXX' @ 3,2 GET level PICTURE '9' @ 4,2 GETsalary PICTURE '999,999' @ 5,2 GET bonus PICTURE '.9999' VALID maxandlsqb;underscore] b() @ 6,2 GET department PICTURE 'XXXXXXXX'andM;READandM;FUNCTION max [underscore] bandM;IF level andgt;=5 RETURN (iif(bonusandless;=.10,.t.,.f.)) ELSERETURN(iff(bonusandless;=.20,.t.,.f.))andM;ENDIFandM;TroubleandM;You're probably asking yourself, &quot;What's the big deal?andP;  Why are we spendingall this time on this?&quot;andP;  Here's why.andP;  Let's change the scenario and set up anexample that has a little more to do with the real world.andM;Take a look at the code in Listing 2.andP;  In this example, Mr. Jones is a level4 employee which, according to the MAX [underscore] B function, has a maximumbonus level of 20 percent.andP;  Bill's bonus is 15 percent, no problem.andM;However, assume that because of hard times, Bill's job is redefined as alevel 6 job.andP;  Bill's maximum bonus is now only 10 percent.andP;  You'd assume fromthe code that when a user changed Mr. Jones' job level, the program wouldcatch the problem of the now illegal bonus, and force the user to change thenumber.andP;  But you know different, don't you?andP;  If the person who makes the joblevel change edits the Level field and then busts out of the READ with eitherthe Esc key or the PgDn key, the VALID on the BONUS field won't execute nomatter what dialect you use.andP;  With dBASE IV, if you don't include theREQUIRED clause in your VALID, the function won't be called even when youcursor over it without changing any of your data.andM;This is not what you want!andP;  If you've been following my advice and areediting memory variables instead of field data, you should check that theuser made the necessary changes to all fields that contain relatedinformation before you allow the edited data to be stored back to the datatable.andP;  If you don't do this, it isn't a question of whether or not you'regoing to have problems, only a question of when.andP;  With FoxPro 2.0 you cancheck for these things using READ/VALID.andM;Dynamic refresh within a READandM;VALID clauses are interesting not only for their data validation function butalso because you can do things with them that, at first sight, don't seemobviuos.andP;  VALIDs execute on a GET-by-GET basis within a READ.andP;  This meansthat, with a little clever planning, you can do things that change the statusof information on the screen in the middle of a READ.andP;  One small example isshown in Listing 3.andM;Notice that I've put the READ inside a loop that continues to cycle as longas users don't press Esc key.andP;  I do this to allow users to go back and changeany data point they want until they have it right.andP;  Each GET invokes the sameVALID routine, SUMTOT.andP;  As you can see, the VALID routine isn't a datavalidation program at all.andP;  It's a program that allows you to do somethingdynamically inside a READ that has nothing to do with validating the GET.andM;In Listing 3, the function takes the sum of the four GETs in your read andrepaints the total where you'd expect it to be.andP;  No matter what type ofnumbers users put in as data, the function returns TRUE.andP;  The VALID doesn'tcare what the values are, since its goal is to sum up the four numbers.andO;While the work being done in this example doesn't seem consequential (itisn't), the concept of &quot;dynamic refresh&quot; is.andP;  I use this in several of mycomplex financial functions to allow users to play &quot;What if's&quot; withoutleaving the READ.andP;  It works well as long as users hit the Enter key and notthe down arrow key when they enter data.andM;Try the down arrow key and see what happens to the data in your fields.andP;  Ibet it isn't exactly what you want.andP;  This &quot;quirk&quot; (&quot;it's not a bug, it's afeature!&quot;) is not really a problem unless you have some spreadsheet jockeyentering numbers for you.andM;Listing 3--An example of dynamic refresh at workandM;CLEAR STORE 0 to aa,bb,cc,dd DO WHILE lastkey() # 27 @ 2,5 SAY 'aa: ' GET aaPICTURE '999,999.99' ; VALID sumtot() @ 3,5 SAY 'bb: ' GET bb PICTURE'999,999.99' ; VALID sumtot() @ 4,5 SAY 'cc: ' GET cc PICTURE '999,999.99' ;VALID sumtot() @ 5,5 SAY 'dd: ' GET dd PICTURE '999,999.99' ; VALID sumtot()@ 6,11 SAY '----------' @ 7,2 SAY 'Total: ' READ ENDDOandM;FUNCTION sumtot ?? chr(7) @ 7,9 CLEAR TO 7,21 @ 7,9 SAY aa+bb+cc+dd PICTURE'9,999,999.99' RETURN(.t.)andM;FoxPro's dynamic readandM;I put the little bell ring (?? CHR(7)) in the VALID clause so that you'd knowexactly when the SUMTOT function in the VALID clause was being executed.andP;  AsI discussed above, when you hear the bell depends on the dialect you'reusing.andP;  With dBASE IV, if you press Enter without changing in the currentvariable, you won't get a beep.andP;  With Clipper, dBXL, and FoxPro you will.andM;In the example, the difference is nothing to worry about, but in some casesit makes a difference.andP;  In one of ny financial functions it can take up to asecond to calculate the result.andP;  I have five or six elements that I canchange and, if I want to change something three elements away, every elementthat I cursor over (but don't change) will invoke the VALID and slow me downif I'm using any version of X-Base except dBASE IV.andM;In this regard, the behavior of the VALID in Ashton-Tate's implementation isactually an advantage.andP;  If you don't want the VALID to execute when the datais unchanged, what do you do if you're using FoxPro or dBXL?andP;  You program,that's what you do.andP;  Not only do you program, but you have two choices on howyou program.andP;  Listing 4 shows you the first option on what you have to do toget the FoxPro SUMTOT valid function to act almost like the dBASE IV versionof the program shown in Listing 3.andM;Notice that the function SUMTOT only executes if the value of the variable ischanged.andP;  If it hasn't been changed, the immediate if returns true.andP;  Listing5 shows you the second option for dealing with the problem.andP;  Instead ofdealing with the VALID before you get to the user-defined function (UDF),this option deals with it within the UDF.andM;Listing 4--Change in the READ for FoxPro and dBXLandM;CLEAR STORE 0 to aa,bb,cc,ddandM;DO WHILE lastkey() # 27 maa = aa mbb = bb mcc = cc mdd = dd @ 2,5 SAY 'aa: 'GET aa PICTURE '999,999.99' ; VALID iif(aa=maa,.t.,sumtot()) @ 3,5 SAY 'bb: 'GET bb PICTURE '999,999.99' ; VALID iif(bb=mbb,.t.,sumtot()) @ 4,5 SAY 'cc: 'GET cc PICTURE '999,999.99' ; VALID iif(cc=mcc,.t.,sumtot()) @ 5,5 SAY 'dd: 'GET dd PICTURE '999,999.99' ; VALID iif(dd=mdd,.t.,sumtot()) @ 6,11 SAY'----------' @ 7,2 SAY 'Total: ' READ ENDDOandM;All this may seem pedantic, but the two options will execute differentlydepending on the operating environment.andP;  The first example will executefaster when operating in a multi-user situation on a big network, with thecode in a procedure file on the server.andP;  The second option implies less codemaintenance if you're constantly changing the variables included in the READ.andM;You often have to remind yourself of the basic operating characteristics of aprogram before you get into trouble.andP;  After you're in the deep stuff it takeslonger to extricate yourself than it would have had you done it right in thefirst place.andM;Listing 5--FoxPro/dBXL SUMTOT Valid CodeandM;FUNCTION sumtotandM;IF updated() IF lastkey() # 5 .and.andP;  lastkey() # 24 .and.andP;  ; lastkey() #.and.andP;  lastkey() # 18 ?? chr(7) @ 7,9 CLEAR TO 7,21 @ 7,9 SAY aa+bb+cc+ddPICTURE '9,999,999.99' ENDIF ENDIF RETURN(.t.)andM;Malcolm C. Rubel is president of Performance Dynamics Associates, a businessapplications consulting firm located in New York City.andP;  He is the author ofProgramming the dBASE III PLUS User Interface and dBASE IV Power Tools(including Clipper code), both from Bantam.andP;  FoxPro 2.0 Power Tools will beavailable from Bantam in September.andP;  He can be reached at (212) 972-2330 oron CompuServe (71441,3362).andO;</TEXT></DOC>