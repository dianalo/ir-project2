<?xml version='1.0' encoding='UTF-8'?>
<DOC><DOCNO>  ZF108-311-310  </DOCNO><DOCID>08 311 310.andM;</DOCID><JOURNAL>Lotus  April 1990 v6 n4 p20(4)* Full Text COPYRIGHT Lotus Publishing Corp. 1990.andM;</JOURNAL><TITLE>Build a front end to a dBASE III file. (1-2-3 Macros) (tutorial)</TITLE><AUTHOR>Delonas, Nick.andM;</AUTHOR><SUMMARY>A guide to building Lotus 1-2-3 macros that provide a dBASE IIIfront end is presented.andP;  Lotus 1-2-3 3.0 offers a sample databasedriver that provides a link to dBASE III files and lets userscreate new files or add records to existing ones.andP;  These files actas 'external tables' in 1-2-3.andP;  The user must first set up a tabledefinition in the worksheet with macro commands.andP;  Five columnscontain the field name, data type, field width, column labels, andfield descriptions.andP;  The next step in building a Lotus dBASE IIIfront end is to set up a data entry model with the WorksheetGlobal Col-Width, Worksheet Column Set-Width, and Range FormatGeneral commands.andP;  A series of type-in macro language formulas isgiven.andP;  The user runs the macro program with the command Alt-G.andP;  Acomplete listing of the resulting macro is given along with adescription of each code function.andM;</SUMMARY><DESCRIPT>Company:   Lotus Development Corp. (products)Ashton-Tate (products).andO;Ticker:    LOTS.andO;Product:   Lotus 1-2-3 (Spreadsheet software) (usage)dBase III (Data base management system) (usage).andO;Topic:     Data Base DesignMacrosSpreadsheetsSoftware PackagesTutorial.andO;Feature:   illustrationprogram.andO;Caption:   Macro listing (program)andM;</DESCRIPT><TEXT>BUILD A FRONT END TO A DBASE III FILEandM;What is Release 3's most valuable new feature?andP;  One strong contender iscertainly the Data External command, which uses the Lotus DataLenstechnology.andP;  We covered the basics of this command in the December issue(&quot;Query External Tables with 1-2-3 Release 3,&quot; page 70).andP;  This month we'llshow you some macro techniques for creating a data-entry-and-retrieval modelthat uses an external database table.andM;Release 3 uses the term &quot;database table&quot; instead of &quot;database&quot; because theexternal database you access may contain more than one table.andM;Once you can enter and retrieve external database records conveniently fromwithin 1-2-3, you can concentrate on expanding your model to include moredata analysis.andP;  You'll then have something that no database package nowoffers: the analytical capabilities and convenience of the 1-2-3 spreadsheet.andM;The sample database driver that comes along with Release 3 provides a linkwith dBase III files.andP;  With it, you can add records to a database file thatalready exists.andP;  You can copy records from that file to the worksheet or toanother external file.andP;  You can even create dBase III files.andP;  You cannot,however, delete or change existing records.andP;  Nor does the driver let youdelete external files or send commands to dBase III.andM;To build this month's model, start with a blank Release 3 worksheet.andP;  Select/Worksheet Insert Sheet After and enter 3 to insert three additional sheets.andO;Hold down the Control key and press PageUp twice to move the cell pointer tosheet D.andM;CREATING A DBASE III FILEandM;Before you can create an external table, you first have to set up at tabledefinition in the worksheet.andP;  Create a table definition in sheet D, as shownin figure 1.andP;  All entries are labels--except those in cell D:C2 rangeD:D2..D:D5, and range D:F1..D:F5.andP;  Cell D:C2 contains a value, and rangesD:D2..D:D5 and D:F1..D:F5 contain @NA Formulas.andP;  Set the widths of columns Cand D to 12.andP;  Then set the width of column E to 26.andM;The table definition tells 1-2-3 how to set up the external data table.andP;  Thefirst column contains the field names.andP;  In this example, the data table hasfive fields: Order_No, Product, Tonnage, Cost, and Markup.andM;The second column specifies the data type for each field.andP;  For example, theOrder_No field will contain numeric data.andM;The third column specifies the width of the field.andP;  When you use the sampledatabase driver, you must enter the column width for character fields as avalue.andP;  You can enter the column width for numeric fields as either a valueor a label.andP;  However, to specify decimal places, you must enter a labelcontaining two numbers separated by a comma.andM;The first number is the total width of the field and the second number is thenumber of decimal places.andP;  For example, the Cost field has a character-widthspecification of 10,2.andP;  That means that the field takes the form of9999999.99, with the decimal point counting as one character.andP;  The 6,4specification for the Markup field yields a field in the form of 9.9999.andM;The fourth column in the table definition specifies column labels.andP;  A columnlabel is simply an alias for a field name.andP;  The sample database driverdoesn't recognize column labels, so you can set all the entries in thiscolumn to @NA.andP;  We entered the label Order# in cell D:D1 simply to remind usthat we're using Order# and Order_No to refer to the same field in theworksheet.andP;  Such reminders can become important.andM;The fifth column contains field descriptions.andP;  Again, the sample driverdoesn't recognize field descriptions.andP;  We entered descriptions in theworksheet simply to remind ourselves what's in the external table.andP;  Whenyou're finished creating the external database, keep this table definition inthe worksheet to save the field descriptions.andM;It is possible to create definition tables from existing external tables withthe Data External List Fields command.andP;  But because the sample driver doesn'trecognize these field descriptions, you won't be able to retrieve them later.andO;The Data External List Fields command will simply enter NA for each fielddescription.andM;The sixth column contains field-creation strings.andP;  Some external databasedrivers will require these and will detail what you need to enter in thedriver documentation.andP;  The sample driver doesn't require field-creationstrings, so you merely need to enter @NA formulas.andM;Now that you've created a table definition, you're ready to create anexternal dBase III table or file.andP;  1-2-3 uses a three-part name to identifyand external table.andP;  It consists of the name of the database driver, the nameof the external database, and the name of the external table.andP;  In this casethe database driver is SAMPLE, the external database is the directory or pathwhere you installed 1-2-3, and the external tables is TONNAGE.DBF.andM;To proceed, select /Data External Create Name.andP;  Select Sample.andP;  Accept thedefault directory.andP;  Enter tonnage as the name of the table to create.andP;  Acceptthe default range name for the table, tonnage.andP;  Then, when prompted for atable-creation string, press the Return key.andM;Now select Definition Use-Definition and indicate range D:A1..D:F5.andP;  Thenselect Go.andM;You've just created the dBase III file TONNAGE.DBF.andP;  The next step is tocreate a model that can use that file.andM;THE DATA-ENTRY MODELandM;Move the cell pointer to cell A:A1 by pressing Control-Home.andP;  Set the defaultcolumn width in the A sheet to 12: Select /Worksheet Global Col-Width andenter 12.andP;  Then set the width of columns B and D to 1 with the WorksheetColumn Set-Width command.andM;Set cell formats as follows:andM;Range  Format C1  General C2  Other Label C3  General C4  Currency 2 C5 Percent 2 C6..C8  Currency 2andM;For example, move the cell pointer to cell C1, select /Range Format General,and press Return.andP;  To create the vertical lines in figure 2, enter * in cellB1 and copy that cell to ranges B2..B8 and D1..D8.andM;Enter all labels in each sheet as shown in figures 2 through 4.andP;  For now,omit all text printed in red.andP;  Those are formulas that you'll enter in amoment.andP;  In figure 4 precede each entry that begins with a slash or backslashwith an apostrophe.andP;  Select /Range Label Right and indicate range A:A1..A:A8to right-align the labels in the range.andM;Use the Range Name Create command to assign the following range names:andM;Name  Range message  A:A11 order#  A:C1 enterin  A:C1..A:C5 cost  A:C4 markupA:C5 source  B:A2..B:E2 crit  B:A4..B:E5 crit1  B:A5 crit2  B:A5..B:E5 outputB:A7..B:E7 output1  B:A8..B:E8 labels  B:B1..B:E1 rtabl  C:B1..C:C2 tabl C:B2..C:C5andM;For example, to assign the range name message, select /Range Name Create,enter message, and then enter A:A11.andM;For the macro's initial run, you must set up the Data Query ranges.andP;  Select/Data Query Input and enter tonnage.andP;  Select Criteria and enter crit.andP;  SelectOutput and enter output.andP;  Then select Quit.andM;Now press the GOTO key and enter C:A7 to move the cell pointer to cell C:A7.andO;Use the Range Name Labels Right command to assign the labels in rangeC:A7..C:A41 as range names for the adjacent cells in column B of sheet C.andM;Enter the following formulas in the specified cells:andM;Cell  Formula A:E1  @IF@CELL(&quot;type&quot;,order#) = &quot;V&quot;,&quot;valid&quot;,&quot;invalid&quot;) A:E2 @IF@CELL(&quot;type&quot;,C2..C2) = &quot;l&quot;,&quot;valid&quot;,&quot;invalid&quot;) A:E3 @IF@CELL(&quot;type&quot;,C3..C3) = &quot;v&quot;,&quot;valid&quot;,&quot;invalid&quot;) A:E4  @IF@CELL(&quot;type&quot;,cost)= &quot;v&quot;,&quot;valid&quot;,&quot;invalid&quot;) A:E5  @IF(C5andless;10#AND,C5andgt; = 0#AND#@CELL(&quot;type&quot;,C5..C5) = &quot;v&quot;,&quot;valid&quot;,&quot;invalid&quot;) A:C6  @IF(C3,C4/C3,0) A:C7  +C6*(1 +C5) A:C8  +C7*C3 B:A2  +A:C1 B:B2  +A:C2 B:C2  +A:C3 B:D2  +A:C4 B:E2  +A:C5andM;Use the Range Unprotect command to unprotect range enterin.andM;To run the macro, hold down the MACRO key (Alt on most computers) and pressG.andP;  The macro moves the cell pointer to cell C1, suppresses display of theborder, and displays a menu in the control panel.andP;  You might think that thescreen would look better it we included a {PANELOFF clear} command in themacro to clear the panel.andP;  Unfortunately, the {PANELOFF clear} commanddoesn't work when DataLens is active.andM;To add a record to the database, select Enter from the menu.andP;  The macroenters the next number in the cell named order#.andP;  Since you're entering thefirst order, the macro enters 1.andP;  If you wish, enter a different number.andP;  Themacro always prompts you for a number one higher than the last order numberyou entered.andM;Change the order number to 1000 and press Return.andP;  Enter D51 as the productcode.andP;  Enter 16 for tonnage.andP;  Enter 51000 for the cost.andP;  Enter 21% formarkup.andP;  Then press F10 to enter the record into the dBase III file.andM;Select Enter again.andP;  Accept 1,001 as the order number.andP;  Enter G23 as theproduct code, 14 for tonnage, 31500 for cost, and 11% for markup.andP;  Press theF10 key to enter the record.andM;Now select Retrieve.andP;  Enter 1000.andP;  Press the F10 key to retrieve the recordfor order number 1,000.andM;Selecting Out halts macro processing and returns you to Ready mode.andM;Here's how it works:andM;{poff}{LET message, &quot;Make selection&quot;} calls the poff routine that freezes thescreen display.andP;  The macro then enters Make selection in the cell namedmessage.andM;{GOTO}enterin~{FRAMEOFF}{ONERROR out} moves the cell pointer to theupper-left corner of the enterin range.andP;  The macro suppresses the display ofthe worksheet frame.andP;  Then it tells 1-2-3 to branch control to the outroutine if there is an error.andP;  We include the {ONERROR} command to handle theerror that occurs when the macro tries to reassign the external table namedtonnage to the range name tonnage.andP;  As an alternative to this method, youcould have the macro use a formula, such as@ISERR(@DCOUNT(tonnage,&quot;ORDER_NO&quot;,crit)), to check to see if 1-2-3 is usingtonnage, before issuing the Data External Use command.andM;/DEUsample~~tonnage~tonnage~Q tells 1-2-3 to use the TONNAGE.DBF file withSAMPLE.andP;  This saves you from having to invoke DataLens manually each time youretrieve the file.andM;/DQI{CE}tonnage~C{CE}crti~O{CE}output~Q selects the Data Query command andassign tonnage as the Input range, crit as the Criterion range, and output asthe Output range.andP;  The macro then selects Quit to exit the Data Query menu.andM;{BLANK enterin}{clear}{pon} erases the contents of the cell named enterin andthen calls the clear and the pon routines.andP;  The clear routine erases thecontents of range output1 and reassigns the range output to range B:A7..B:E7.andO;This prepares 1-2-3 for the Data Query Extract command in the ret routine.andO;The pon routine reactivates the screen for updating with {WINDOWSON} and a{PANELON} command.andM;{MENUCALL mmnu}{branch loop} calls the menu instruction that are in and nextto the cell named mmnu.andP;  When the macro issues the {MENUCALL} command, 1-2-3assumes that the labels in the range C:B10..C:D10 are instructions forcreating custom menu commands.andP;  It further assumes that the labels in rangeC:B11..C:D11 are instructions for creating custom menu descriptions.andP;  Themacro displays the custom menu commands and the custom menu description ofthe highlighted command.andP;  From the user's point of view, the custom menu oroperates exactly the same way 1-2-3's own menu system works.andP;  When the userhighlights a particular custom command, control passes to the macro two cellsdown from the corresponding instruction in range C:B10..C:D10.andP;  For example,if you select Enter, control goes to the macro command in cell C:B12.andP;  Afteryou select either Enter or Retrieve and 1-2-3 runs the associated macroroutine, control passes to the loop routine.andP;  So the macro effectivelyrepeats the {MENUCALL} command until you select Out from the custom menuprompt.andM;When you select Enter from the menu, 1-2-3 runs the ent routine.andP;  Here's howit works:andM;{poff}{BLANK enterin}{msg}{LET last,last+1}{clear} calls the poff routinethat freezes the screen display.andP;  The macro erases the contents of rangeenterin.andP;  Then it calls the msg routine, which enters press andless;F10andgt; to enter orretrieve item in the cell named message.andP;  The macro then increases the valuein the cell named last by 1 and calls the clear routine.andM;{LET order#,last}{pon}{FORM enterin,tab} copies the value in the cell namedlast to the cell named order#.andP;  The macro calls the pon routine to resumescreen updating, then issues a {FORM} command to accept data entry.andP;  Thefirst argument in the {FORM} command identifies the Form-Input range.andP;  Verymuch like the Range Input command, the {FORm} command suspends macroprocessing so that you can enter and edit data in the unprotected cells inthis range.andP;  The second argument identifies the Call-Table range--in thiscase, tabl.andP;  This range consist of two columns.andP;  Each cell in the firstcolumn contains the macro name of a key on the keyboard.andP;  If you press any ofthe listed keys during data entry, 1-2-3 will run the macro instructions inthe cell adjacent to the cell containing the key name.andP;  So, for example, ifyou press the Return key, 1-2-3 processes the macro instructions in cellC:C4.andM;{poff}{LET last,order#}{APPENDBELOW output,source} calls poff to freeze thescreen display and copies of the value in order# to last.andP;  The macro thenuses the {APPENDBELOW} command to add the record you just entered to theoutput range.andP;  The source range simply contains formulas that return yourrecord in a horizontal orientation.andM;/DQMIQ{clear}{LET message,&quot;Make selection?}{pon} adds the new record to thedBase III file and returns to Ready mode by using the Data Query ModifyInsert Quit command.andP;  The macro calls the clear routine and enters Makeselection in the cell named message.andP;  The macro then calls the pon routine toreactivate the screen display.andM;If you select Retrieve from the macro menu, 1-2-3 runs the ret routine.andO;Here's how that works:andM;{BLANK enterin}{msg}{FORM order#,rtabl} erases the contents of the rangeenterin and calls the routine msg.andP;  The macro then uses the {FORM} command toaccept the order number of the record you want to retrieve.andM;{poff}{BLANK crit2} calls poff to freeze the screen display and erases thecontents of the crit2 range.andM;{LET crit1,order#} copies the value in order# to crit1.andM;/DQEQ/RToutput1~enterin~/RUenterin~ extracts the desired record to the outputrange and copies that record to the enterin range using the Range Transposecommand.andP;  The macro then unprotects all the cells in the enterin range sincethe Range Transpose command changed them to protected cells.andM;Note that this routine cannot handle files where more than one record sharethe same order number.andP;  You might want to include an error-checking procedurefor your own applications.andP;  Nor does the macro tell the user if 1-2-3 cannotfind the order number.andP;  Instead, the macro simply erases the enterin range.andO;You could include a routine that would flash a message like Record not found.andO;You might use an @DCOUNT formula to check for a particular record.andM;/RFC~cost~/RFP~markup~ resets the formats in the cells named costs and markupto Currency 2 and Percent 2, respectively.andM;{LET message,&quot;Make selection&quot;}{pon}{RETURN} enters Make selection in the cellnamed message and calls the pon routine to reactivate the screen display.andO;The macro then returns control to the calling routine.andO;</TEXT></DOC>