<?xml version='1.0' encoding='UTF-8'?>
<DOC><DOCNO>  ZF108-019-028  </DOCNO><DOCID>08 019 028.andM;</DOCID><JOURNAL>PC Magazine  Jan 30 1990 v9 n2 p283(8)* Full Text COPYRIGHT Ziff-Davis Publishing Co. 1990.andM;</JOURNAL><TITLE>Add music, color, and power to your batch files with Batchman.andO;(includes related article on Batchman by modem.) (tutorial)</TITLE><AUTHOR>Mefford, Michael J.andO;AttFile:   PCMAG\V09N02\BATCHMAN.ASM;0 Program:  BATCHMAN.ASM  Assembly code.andO;PCMAG\V09N02\BATCHMAN.COM;2 Program:  BATCHMAN.COM  Refine your batch files.andO;PCMAG\V09N02\BATCHMAN.DOC;0 Program:  BATCHMAN.DOC  Documentation.andM;</AUTHOR><SUMMARY>The Batchman utility program is designed to provide batch filesmuch more computing power and add many of the refinements missingwith DOS.andP;  It is a collection of 48 batch file utilities in one 6Kprogram.andP;  The program can be downloaded from PC MagNet.andP;  Users whowant to examine the source code can download Batchman.ASM.andO;Assembly or basic listings are available by mail.andP;  An extensivediscussion of programming techniques is included.andP;  The programwill make a system much more responsive to a user's needs.andM;</SUMMARY><DESCRIPT>Topic:     Utility ProgramsBatch ProcessingTutorial.andO;Feature:   illustrationtable.andO;Caption:   Background and foreground color values. (table)Musical note frequencies. (table)andM;</DESCRIPT><TEXT>Add Music, Color, and Power to Your Batch Files with BATCHMAN Everyone loveswhat batch files do, but nobody likes to write them.andP;  If you've ever tried togo beyond creating a simple AUTOEXEC.BAT file, the limitations of the batchfile language and its internal DOS commands quickly become apparent.andM;If you change the current directory in a batch file, for example, restoringit at the end is awkward at best.andP;  You can't control the display color whenyou invoke the ECHO or CLS commands.andP;  And that the batch file commandandM;IF stringl==string2andM;is case sensitive means you have to write a whole series of compares tohandle mixed-case strings.andM;This issue's utility, BATCHMAN, is designed both to give your batch filessignificantly more power and to add many of the refinements we all wish DOSprovided.andP;  You can check the DOS version, available memory, or display typeand then branch accordingly.andP;  You can create colorful menus that branch on auser keypress.andP;  And, among its many other capabilities, BATCHMAN will let youadjust the keyboard typematic rate and tame the grating DOS beep or turn itinto a tune.andM;BATCHMAN is actually a collection of 48 batch file enhancement utilities, allrolled into one 6K program.andP;  This provides more than convenience: ifBATCHMAN's utilities were stored separately, at a minimum of one clustereach, they'd take up about 100K of disk space.andM;Because of the large number of utilities included in BATCHMAN, however, therewon't be space here to present our usual discussion of the programmingtechniques used in the program itself.andP;  Nor is it possible to encapsulate all48 different BATCHMAN commands in a separate DOS-manual lookalike page.andM;You can get a ready-to-run copy of BATCHMAN by downloading it from PC MagNet,as explained in the sidebar &quot;BATCHMAN by Modem.&quot;andP;  Because of space limits, wecannot print the source code here, but if you're interested in examining it,download BATCHMAN.ASM as well.andP;  To get the assembly or BASIC listings by mailor fax, send a written request with your name, address, and fax number (ifapplicable) to PC Magazine, Utilities, One Park Ave., New York, NY 10016;Attention: Carolyn Falconer.andP;  No phone calls please.andP;  (Note: estimated faxlength is 30 pages.)andM;PC MagNet is also the best place to contact me if you have questions or wouldlike insights into the workings of the program.andP;  (And perhaps our technicaleditor will feel the urge to publish our discussions in a later issue.)andM;ERRORLEVEL CODEandM;The key to BATCHMAN's operations is the ERRORLEVEL code, a number thatprograms can report to DOS when they terminate and that can be acted uponfrom a batch file.andP;  &quot;ERRORLEVEL&quot; is a poorly chosen name, for although it canindicate that something went wrong with the program, the ERRORLEVEL codereally has many more uses.andP;  The term &quot;MESSAGENUMBER&quot; would have been a bettername, for the ERRORLEVEL is simply a means by which a program can communicatewith the DOS batch processor.andP;  DOS's designers stuck us with ERRORLEVEL,however, which I'll abbreviate as EL for the rest of this article.andM;An EL can have a value between 0 and 255.andP;  Each BATCHMAN command returnsinformation as an EL.andP;  An explanation of the syntax of each of the BATCHMANcommands and the ELs they return will be found below.andP;  For examples of how touse the BATCHMAN ELs within batch files, see Neil J. Rubenking's Lab Notes,&quot;Sharpening Your DOS Batch File Programming Skills,&quot; in this issue.andM;The syntax for BATCHMAN isandM;BATCHMAN [command] [/R]andM;Entering BATCHMAN without any parameters (or with an invalid parameter) willbring up a multiscreen display that lists all the BATCHMAN commands.andP;  Theoptional arguments are parameters for any given command.andP;  If you add theoptional /R switch, BATCHMAN will display the EL returned from the command.andO;This Report option will be most helpful when you are designing and debuggingyour batch files.andP;  Be sure to place BATCHMAN in a directory included on theDOS PATH so that your batch files can find it.andM;THE BATCHMAN COMMANDSandM;I will be using the following conventions throughout the article: thecommands will be listed first, followed by any parameters they might accept,followed by the EL the command will return.andP;  I'll put the EL in curlybrackets so no one will think it's part of the command syntax and try to typeit in.andP;  For example.andM;CLS [nn] {EL=0}andM;If it is entered without the optional nn color argument, the commandandM;BATCHMAN CLSandM;will clear the screen with whatever color it finds at the current cursorposition.andP;  This provides the most flexibility when you plan to distribute aBATCHMAN batch file to other systems, because it retains the user's customcolor scheme.andM;If you wish to control the CLS color, just add the color argument nn, wherenn is a decimal or hexadecimal value derived from the table in Figure 1.andO;Hexadecimal numbers need a suffix of &quot;h&quot; to distinguish them from decimal.andO;Selecting a color in hex is easier than in decimal because each of the 16possible values for each of the background and foreground colors fits into asingle digit: the first digit is background, the second foreground.andM;To clear the screen so that subsequent DOS output will use blue letters on alight gray background, for example, you would enterandM;BATCHMAN CLS 71handM;The first number (7) is the background color, and the second (1) is theforeground color.andP;  To do the same using a decimal number requires a littlemath: the background color is multiplied by 16 and added to the foreground.andO;In the above example, the decimal equivalent would be (7*16)+ 1 = 113, so theequivalent command in decimal would beandM;BATCHMAN CLS 113andM;Like its DOS counterpart, BATCHMAN's CLS homes the cursor to the top-leftcorner.andP;  Unlike the DOS CLS, however, BATCHMAN's will clear the whole screenproperly in video modes such as the 43-line EGA and 50-line VGA modes.andM;CECHO [C] [nn,]string {EL=0}andM;CECHO is similar to the DOS ECHO command except you can choose the color ofthe echoed string.andP;  The nn color value is entered in the same manner as withCLS, and again, if you don't enter a color value, BATCHMAN will use thecurrently specified color.andP;  To echo a &quot;Zowie!&quot; to the display in aneye-catching blinking yellow on red, you would enterandM;BATCHMAN CECHO CEh, Zowie!andM;The hex value C, for the background color, normally displays as orange for aforeground color.andP;  When used as a background color, however, it displays asthe blinking low-intensity counterpart, red.andP;  Keep in mind that anyhigh-intensity color selected for the background will blink in itscoresponding low-intensity color value.andM;The optional C parameter that is shown in CECHO syntax (don't confuse it withthe hex C color value in the immediately preceding example) stands for &quot;nocarriage returns.&quot;andP;  Normally, both CECHO and the DOS ECHO move to the nextline after echoing a string.andP;  At times this is not desirable.andP;  For example,you might wish to echo two strings with different colors on the same line.andO;With BATCHMAN you can suppress the carriage return by adding a solitary C asthe first argument.andP;  For example, to display a red on yellow blinking&quot;Zowie!&quot; followed by a normal red on yellow &quot;Batchman!&quot; on the same line,your batch file would consist ofandM;ECHO OFF BATCHMAN CECHO C CEh, Zowie! BATCHMAN CECHO 4Eh, Batchman!andM;You can suppress the carriage rturn to prevent the display from scrollingwhen you echo to the last line of the display.andP;  This feature makesfull-screen menus feasible, whereas echoing to the last line with DOS ECHOcauses the screen to scroll, spoiling any previous display layout.andM;SETLOOP [N] {EL=0} DECLOOP {EL=SETLOOP-1}andM;You use SETLOOP and DECLOOP when you want to repeat a set of batch filecommands.andP;  SETLOOP sets a loop counter to the n argument, which can be adecimal number between 0 and 255.andP;  Once the counter is set, the BATCHMANDECLOOP command will decrement the counter each time it is executed andreturn the new value of the loop counter as an EL.andP;  The short batch fileandM;ECHO OFF BATCHMAN SETLOOP 10 :HERE BATCHMAN CEHO ZONK: BATCHMAN DECLOOP IFERRORLEVEL 1 GOTO HEREandM;will echo &quot;ZONK!&quot; to the display ten times before terminating.andP;  The batchprocessor will branch to the HERE label as long as the EL is 1 or greater.andM;Programmers may wonder where the loop counter is stored while other commandsare executing.andP;  For the SETLOOP and PUSHPATH commands (PUSHPATH/POPPATH willbe discussed below) BATCHMAN creates a small TSR of approximately 500 bytes.andO;The loop counter uses 1 byte for its storage; the balance is reserved forpath strings.andP;  When the loop counter becomes zero, the BATCHMAN TSR data areais returned to the system memory pool (unless PUSHPATH is also using the dataarea).andP;  Note that since the loop counter is only 1 byte, you cannot do loopnesting.andM;If you exit a batch file before SETLOOP has decremented to zero, the TSR dataarea will not be released.andP;  You should construct your batch files so that anyearly exit from a loop will execute a SETLOOP 0 to force a recovery of theTSR data area.andP;  BATCHMAN is smart enough not only to find its previous TSRdata, but also to prevent the creation of another if you try to enter twoSETLOOP commands.andM;QFORMAT [d:] [N] {EL=0 if successful; EL=1 if not.}andM;QFORMAT will wipe out all the files and subdirectories on a floppy disk at asingle stroke.andP;  To keep you from trashing your hard disk, the command acceptsonly A: or B: as drive arguments.andP;  All other drive requests are ignored, andyou don't have to list the drive if A: or B: is the current default drive.andM;Further, QFORMAT warns you that all data will be lost.andP;  To confirm, you mustpress Y and Enter.andP;  Any other keypress aborts the process.andP;  If you don't wantBATCHMAN to pause and ask for your approval, you can add the optional Nargument to the command.andP;  The N stands for &quot;no ask.&quot;andP;  Use this option withcaution!andM;QFORMAT will work only on diskettes that have already been formatted by DOS.andO;The DOS FORMAT command puts vital information about the media type, number ofclusters per FAT, and so forth in the boot sector of the disk.andP;  BATCHMAN'sQFORMAT command uses this information to find and place zeros in the FAT androot directory sectors of the disk.andM;The reason QFORMAT can be so fast is that it doesn't have to do the same workas the DOS FORMAT command.andP;  FORMAT not only does a low-level format, but italso writes over the entire data area of the disk.andP;  It's the low-level- anddata-format process that takes forever.andP;  A low-level format needs to be doneonly once, and QFORMAT blithely skips that step.andP;  QFORMAT is sophisticatedenough, however, to preserve bad-sector information.andM;PUSHPATH {EL=0 if successful; EL=1 if not}andM;POPPATH {EL=0 if successful; EL=1 if not}andM;PUSHPATH saves the current drive and directory, which can later be restoredwith POPPATH.andP;  Typically, a batch file that executes an application includesa DOS CD command (often a change of drive as well) to move operations to theplace where the application resides.andP;  After the application terminates, it'susually desirable to return to the original path.andM;By way of example, to run Lotus 1-2-3 on drive D: and then return to thedefault path afterwards, your batch file would look something like this:andM;BATCHMAN PUSHPATH D: CD /123 123 BATCHMAN POPPATHandM;PUSHpath saves the current path in a TSR data area, just as the SETLOOPcommand does.andP;  While only 1 byte is reserved for SETLOOP's loop counter,BATCHMAN's TSR data area allows stacking up several paths with PUSHPATH.andO;Subsequent POPPATH commands will retrieve the paths on a LIFO (Last In FirstOut) stack basis.andM;Suppose, for instance, that you're currently in your directory and you issuethe following commands:andM;BATCHMAN PUSHPATH CD /DOS BATCHMAN PUSHPATH CD /PCMAG BATCHMAN POPPATHBATCHMAN POPPATHandM;In this sequence, the first POPPATH puts you back into the /DOS subdirectory,and the last POPPATH restores you to the root directory from which youstarted.andM;The number of path layers that can be stored will vary with the length ofeach path pushed onto the stack.andP;  BATCHMAN's TSR area reserves 408 bytes forpaths, which allows for six levels of nested paths if each path is themaximum 65 characters allowed by DOS.andP;  Shorter pathnames will allow nestingmore than six levels.andP;  If necessary, you can change the storage size bymodifying the DIR_COUNT equate in the assembly listing.andM;BATCHMAN returns an EL of 1 if it finds the stack too full for anotherPUSHPATH or if the stack is already empty with a POPPATH.andP;  Otherwise, the ELreturned is 0.andP;  When the last path is popped off the stack, the TSR data areais discarded and returned to the DOS memory pool.andM;ANSI {EL=0 if ANSI found; EL=1 if not found}andM;This BATCHMAN command is designed to determine simply whether ANSI.SYS is oris not installed.andP;  If the EL is 1, you can then branch around any ANSI.SYSescape sequences contained in your batch files.andP;  BATCHMAN is smart enough todetect not only ANSI.SYS, but my own ANSI.COM alternative (see the January31, 1989, Utilities column), but it will not find other ANSI.SYS emulators,such as DESQview's DV-ANSI.andM;BEEP [m, n[;m,n]...] {EL=0}andM;The BATCHMAN BEEP command gives you a lot of flexibility in controlling thefrequency and length of the sound DOS emits in response to a Ctrl-Gcharacter.andP;  The m,n beep arguments are decimal numbers used in pairs andseparated by a comma.andP;  The m value is the frequency in hertz, and n is thenumber of 1/18th-second increments that make up the duration.andM;The frequencies of various musical notes can be found in the table in Figure2.andP;  The command for a middle-C beep of a half second, for example, would beandM;BATCHMAN BEEP 262,9andM;By separating the argument pairs with semicolons, you can produce a series oftones with the same BEEP command.andP;  You might, for example, want to tryandM;BATCHMAN BEEP 392, 3:523, 3;659, 3;784, 3;10, 3;659, 3;784, 12andM;The lowest valid frequency is 19, a very low buzzing sound.andP;  You can use avalue less than 19 to create pauses between tones: no sound will be emitted,but the duration argument is executed, effectively producing a programmabledelay between notes.andP;  For an example of how far you can go with this, see thebatch file Neil Rbenking provides to play the &quot;Batman&quot; theme song in thisissue's Lab Notes.andM;If you omit all arguments, BEEP defaults to 1046,1--a C note lasting 1/18thof a second.andP;  The DOS Ctrl-G beep is a frequency of 886 that lasts for 1second.andP;  Musically, a frequency of 886 is an out-of-tune A, which probablyexplains why it grates on so many ears.andM;WAITTIL hh:mm[:ss] {EL=0 if succesful; EL=1 if aborted}andM;WAITTIL provides a convenient way to pause until a certain time of day.andP;  Thehh:mm:[ss] argument is the time in hours, minutes, and (optionally) seconds.andO;BATCHMAN will wait until the specified time arrives, but you can manuallyabort the wait by entering any keystroke.andP;  A typical application for WAITTILwould be to execute an electronic bulletin board communications program thatwould automatically download messages late at night when rates are lower.andM;WAITFOR [mm:]ss {EL=0 if successful; EL=0 if aborted}andM;WAITFOR simply pause for a specified number of minutes (mm) and seconds (ss).andO;You can omit the minute part of the argument if you desire.andP;  As with WAITTIL,the WAITFOR delay can be overridden by pressing a key.andM;CURSORTYPE [m, n]andM;You can use CURSORTYPE either to create a cursor size that suits your tasteor to restore the normal underline cursor after an application alters it.andO;Entering CURSORTYPE without any arguments will default to the standardunderline cursor.andP;  To create a custom cursor, you supply the m, n argumentsas the start- and stop-line values.andP;  These values can be either deciomal orhex; for hex input, add the &quot;h&quot; suffix to the number.andM;The top of the character box is logical line zero; successively numberedlines increment downward.andP;  The valid scan-line values used for m and n are 0to 7 for a CGA, 0 to 13 for a monochrome or EGA, and 0 to 15 for a VGA.andP;  Thedefault underline cursor start/stop lines are 6, 7 for a CGA, 11, 12 for amonochrome or EGA, and 13, 14 for a VGA.andP;  To set an EGA solid block cursor,for example, you should enter the following:andM;BATCHMAN CURSORTYPE 0, 13andM;Note that the EGA BIOS on some video boards will attempt to override yourselections.andP;  To avoid this mishap BATCHMAN temporarily turns off ths BIOS EGAemulation logic for all video boards when the cursor type is set, and thisseems to work for most systems.andP;  However, if entering CURSORTYPE withoutarguments does not give you the normal default underline cursor, you canexplicitly request an underline cursor that fits your display.andP;  You may findthat you need to do this for video modes other than the normal 25-line modes.andO;A &quot;wraparound&quot; cursor, in which the stop line has a lesser value than thestart line, is supported by the hardware of only some video systems.andM;BREAK  {EL=0 if OFF; EL=1 if ON}andM;The BATCHMAN BREAK command returns the current state of DOS's Ctrl-Breakchecking.andP;  You can change the state of BREAK with the DOS command of the samename.andM;DRIVEEXIST d: {EL=1 if exist; EL=0 if not} DIREXIST directory {EL=1 if exist;EL=0 if not}andM;These two BATCHMAN commands are used to return an EL of 1 to your batch filesif the specified variable exists and an EL of 0 if it does not.andM;ISVOL [d:]volume {EL=1 if exist; EL=0 if not}andM;Similarly, this command returns an EL of 1 if a particular disk volume existson the named drive.andM;YEAR  {EL=year from 1980 (0-199), where 0=1980} MONTH  {EL=(1-12)} DAY {EL=(1-31)} WEEKDAY  {EL=(0-6), where Sun=0; Sat=6} HOUR  {EL=(0-23)} MINUTE {EL=(0-59)} SECOND  {EL=(0-59)}andM;This group of BATCHMAN commands returns the system time and date.andP;  Note thatyou can obtain a relatively fine resolution of the time.andM;VIDEOMODE  {EL=(0-19)}andM;The ERRORLEVEL that is returned by the VIDEOMODE command allows you todetermine which of the possible screen modes listed in Figure 3 is currentlybeing used by your display.andM;ROWS  {EL=display rows} COLS  {EL=display columns}andM;These obvious but very handy commands return the current number of rows orcolumns displayed.andM;SETCURSOR m, n  {EL=0}andM;By supplying values for m (the row) and n (the column), you can use SETCURSORto place your cursor at the specified screen location.andP;  By using SETCURSOR inconcert with CECHO, you can precisely control the location of your messages.andO;For example, to display &quot;Gotham City&quot; in blue in the middle of the screen,you would create the following batch file:andM;ECHO OFF BATCHMAN SETCURSOR 12, 35 BATCHMAN CECHO 1,Gotham CityandM;Be sure to include the ECHO OFF command, so that DOS won't spoil your displayby echoing the commands.andP;  ECHO OFF will also ensure that the cursor doesn'treturn to the beginning of the next line for the CECHO command.andM;SETCURSOR can also hide the cursor.andP;  Just set the cursor to display on line26, which is off-screen.andP;  You must issue a second SETCURSOR command that putsthe cursor back on-screen once the hidden cursor is no longer needed, or youwon't be able to see what you type!andP;  If you forget, don't panic: press Esc,blindly type CLS, and press Enter.andP;  Things will return to normal with thecursor homed to the top of the display.andM;E43V50 {EL=0 if successful; EL=1 if not}andM;This BATCHMAN command loads the 8 by 8 BIOS font for an EGA or VGA monitor.andO;This changes the number of lines displayed to 43 (EGA) or 50 (VGA).andP;  You canuse the DOS MODE command to return to the normal 25-line display.andM;PRTSC  {EL=0}andM;This command will execute a printer screen dump exactly as if you had pressedShift-PrtSc on an 83-key keyboard or the dedicated PrtSc key that you see ona 101-key keyboard.andM;COMPARE string1 string2 {EL=0 if match; EL=1 if no match}andM;The BATCHMAN COMPARE makes a case-insensitive comparison between two strings.andO;For most purposes you'll probably want to use COMPARE instead of thecase-sensitive DOS batch command:andM;IF string1==string2andM;With the DOS IF string comparison, a non-case-sensitive match requires twotests--one for uppercase and one for lowercase.andP;  Even this does not guaranteea match if the string is a mixture of upper- and lowercase, as might occur ifa batch file were looking for a person's name, for example.andP;  COMPARE solvesthis case problem.andP;  Note that the BATCHMAN COMPARE does not need the doubleequals signs the DOS IF command uses.andM;CANCOPY filespec [d:] {EL=0 if room to copy; EL=1 if not}andM;Before you copy a file or a number of files to another drive (especially afloppy disk drive), you can use CANCOPY to see if there is enough disk spacefor all the specified files.andP;  The filespec you supply can use both the DOS ?andO;and * wildcards.andP;  If you don't specify the target drive, the default drivewill be checked for available room.andP;  Thus, for example, to check whether thecollection of PC Magazine utilities you keep in a directory called PCMAG ondrive C: will fit onto a floppy, you would enter the commandandM;BATCHMAN CANCOPY C:\PCMAG\*.* A:andM;BATCHMAN will return an EL of 0 if there is room for all the files; otherwisea 1 will be returned.andP;  If you enter this from the DOS command line, you'llwant to include the /R option to see the EL returned on-screen.andM;WARMBOOT COLDBOOTandM;As their names imply, WARMBOOT and COLDBOOT reboot your system.andP;  WARMBOOTdoes the same thing as pressing Ctrl-Alt-Del; COLDBOOT is like hitting thebig red switch.andP;  A COLDBOOT does a memory check (among other things) thatWARMBOOT does not, and it takes a lot more time.andP;  Of course, be forewarnedthat with either of these commands, all unsaved data in RAM memory will belost.andP;  Note that WARMBOOT and COLDBOOT may not work on some non-compatiblesystems.andM;SHIFT ALT | CTRL {EL=1 if depressed; EL=0 if not}andM;This command returns the state of either the Alt or Ctrl key.andP;  For example,andM;BATCHMAN CTRLandM;returns an EL of 1 if the Ctrl key is currently depressed.andP;  You can use theSHIFT command along with the BATCHMAN GETKEY command without arguments todetect Alt-key presses.andP;  (See GETKEY, below, for an example.)andM;NUMLOCK [ON | OFF]  {EL=0} CAPSLOCK [ON | OFF]  {EL=0} SCROLLOCK [ON | OFF] {EL=0}andM;These three commands toggle the current shift state of the NumLock, CapsLock,or ScrollLock keys when used without the ON or OFF options.andP;  They explicitlyturn the three keys on or off if the optional arguments are supplied.andM;Thus, for exampleandM;BATCHMAN NUMLOCKandM;will toggle the NumLock state on if it was off or off if it was on.andP;  EnteringandM;BATCHMAN NUMLOCK OFFandM;will turn the NumLock state off regardless of whether it is currently on oroff.andP;  This would be a useful line in your AUTOEXEC.BAT if you use the numerickeypad for cursor navigation instead of number entry.andP;  Note that on somekeyboards the LED indicator lights may not faithfully track changes in shiftstatus.andM;RENDIR old new  {EL=0 if successful; EL=1 if not}andM;Long-time users of our utilities will recognize this command, as it performsthe same function as the standalone RENDIR utility published in our April 15,1986, issue.andP;  The version presented here will rename a directory, but only onsystems using DOS 3.0 or later.andP;  To use it, simply enter the path of the olddirectory and the new name.andM;Imagine, for example, that you want to rename a temporary directory,designatedandM;UtilitiesandM;TMP, on the C: drive.andP;  If the permanent name is, say, ROBIN, you would enterandM;BATCHMAN RENDIR C:\TMP C:\ROBINandM;Be sure to include the complete path for both the old and the new directorynames if the directory is other than the default.andM;ROMDATE {KL=0}andM;ROMDATE displays the 8 bytes of the BIOS date at address FFFF:0005 of the ROMBIOS.andP;  Usually, the display will be something like 1/07/87, but some cloneBIOSs do not have a date.andP;  If no ASCII numbers are found, BATCHMAN displaysnothing.andM;GETKEY ['string' n] {KL=scan code if no ['string' n] list; else KL=positionin list.}andM;There are probably hundreds of versions of the batch file GETKEY program.andO;And each version returns the scan code of the next key you press as an ELvalue.andP;  Furthermore, if you enter the BATCHMAN GETKEY command without theoptional (bracketed) arguments, it will perform the same task.andM;If it is entered without arguments, the GETKEY command can also be used withthe BATCHMAN SHIFT command to detect Alt- or Ctrl-key combinations.andP;  The scancode for the Q key is 16.andP;  In order to check for an Alt-Q keypress (perhapsas a Quit key command), you would use the following batch file:andM;ECHO OFF :GETKEY BATCHMAN GETKEY IF NOT ERRORLEVEL 16 GOTO GETKEY BATCHMANSHIFT ALT IF NOT ERRORLEVEL 1 GOTO GETKEY ECHO Alt-Q was pressed.andM;GETKEY provides still another kind of functionality with its optional keylist.andP;  The information you need may not be the scan code of a given key, butrather its position in a string.andP;  If you supply the optional 'string'argument to GETKEY, BATCHMAN will wait either until one of those keys listedhas been pressed or until you break out of the command with Ctrl-Break orCtrol-C.andP;  An example may be helpful here.andP;  With the commandandM;BATCHMAN GETKEY 'yn'andM;BATCHMAN will wait until either the Y or the N key or one of the break keysmentioned above is detected.andP;  All other keypresses are ignored, and if thebreak-out keys are pressed, the EL returned will be 255.andP;  GETKEY is notcase-sensitive, so if either Y or y is pressed, the EL will be 1, since the yis the first character in the string of valid keypresses.andP;  For N, an EL of 2will be returned.andM;The string must be enclosed in a pair of either single or double quotes.andP;  Ifyou want thesingle quote included as a valid keypress, enclose it in doublequotes and vice versa for double quotes, as in the following example:andM;BATCHMAN GETKEY '&quot;'andM;You can also include the function keys (even the F11 and F12 keys of theextended keyboard) in the GETKEY list.andP;  The function key numbers are listedwithout quotes, (they are designated by the n in the command syntax above),and may or may not be further identified with a leading &quot;F.&quot;andP;  Multiplefunction keys are delimited by either a space, comma, or semicolon.andP;  To addthe F1 and F2 as valid keys to the &quot;yn&quot; string example above, you would entereitherandM;BATCHMAN GETKEY &quot;yn&quot; F1 F2andM;or justandM;BATCHMAN GETKEY &quot;yn&quot; 1 2andM;If F1 is now pressed, the returned EL will be 3, since F1 is the third entryin the list.andM;DOSVER {EL=(major*32)+minor}andM;DOSVER returns an EL representation of the DOS version i use.andP;  DOS versionnumbers have two parts, the major version (the number to the left of thedecimal point) and the minor version (the number to the right).andP;  For DOS3.10, then, 3 is the major and 10 is the minor.andP;  Since the largest EL numberis 255, the DOS version number does not fit conveniently into an EL.andP;  For DOS3.10, for example, if the dot is discarded, the remaining 310 is too largefor an EL.andM;Of course, BATCHMAN could be content to return only the major number,truncating anything after the dot, or even the first digit after the dot.andO;But that would be less than sufficient for some applications.andP;  So instead,the DOSVER command compresses the version number by multiplying the majornumber by 32 and adding it to the minor number.andP;  With DOS 3.30 the resultwill be (3*32)+30=126; with DOS 4.00 it would be 128.andP;  If there had been aDOS 3.32, we would have a problem, of course, since this would also return128.andP;  Historically speaking, however, we are safe here.andM;MAINMEM n | R {KL=0 if enough} EXPMEM n | R {KL=0 if enough} EXTMEM n | R{KL=0 if enough}andM;The arguments for these three memory commands can either be a decimal number,n, or an R.andP;  The decimal argument is used to check whether the desire amountof memory (in K) is free.andP;  If there is enough free memory to meet therequest, the EL will be 0.andP;  Thus, if an application needs 512K of the 640Kmaximum possible with DOS, you would enter.andM;BATCHMAN MAINMEM 512andM;The EL will return 0 if there are at least 512K bytes free; otherwise, I.andO;Your batch file can then branch to an error message if there is not enoughmemory to run the application.andP;  Note that these memory commands do notallocate the memory.andP;  They only check to see if it is free.andM;The alternative R argument stands for Report and will display the currentfree memory of the type requested on the screen.andP;  To see how much freeexpanded memory you have, for example, enterandM;BATCHMAN EXPMEM RandM;The report option of the three types of memory will go nicely with BATCHMAN'sROMDATE command in a system information batch file.andM;DISPLAY {KL=display type}andM;The DISPLAY command will report on the type of display your system hasinstalled.andP;  The values returned by dISPLAY as EL codes areandM;1=MDA 2=CGA 4=EGA color 5=EGA mono 6=PGS 7=VGA mono 8=VGA color 11=MCGA mono12=MCGA colorandM;Similarly, the CPU commandandM;CPU {KL=CPU type}andM;returns an EL that indicates the microprocessor used by your machine.andP;  Thespecific EL numbers are 1=8086/8088; 2=80186; 3=80286; and 4=80386.andM;WINDOW m, n, w, h [,c,b] {KL=0 if successful; KL=1 if not}andM;The powerful WINDOW command displays screen boxes.andP;  It provides severalparameters and options.andP;  The first two decimal numbers (m,n) are the row andcolumn of the top-left corner of the window.andP;  The next two decimal numbers(w,h) are the desired width and height of the window including the bordercharacters).andM;The smallest size that WINDOW allows is two characters in width and height.andO;The optional fifth parameter, c, can be either a hexadecimal or decimalnumber for the color of the window.andP;  If no color argument is supplied, thecurrent color of the screen is used by default.andP;  The last parameter, b, setsthe type of border used to surround the window.andP;  If no parameter is found,spaces are used.andP;  If you enter a minus sign for b, a single-line boxcharacter will be drawn.andP;  An equals sign for b will produce the double-linebox character.andP;  In all cases, the center of the window is cleared with spacesof the chosen color.andP;  For example, the commandandM;BATCHMAN WINDOW 1,1,80,25,17h,=andM;creats a blue window with white double-line box characters that will fill theentire screen, making a nice menu frame.andP;  Text could then be added with theBATCHMAN SETCURSOR and CECHO commands.andM;TYPEMATIC [m, n | N] {KL=0 if valid parameters; EL=1 if not} INSERT 62(2)-12lines m=typematic rate (0 - 31); larger m=faster rate INSERT 62(2)-12 linesn=initial delay (0 - 3); larger n=longer delayandM;N=normal: m=25; n=1andM;default: m=25; n=0andM;TYPEMATIC works only with keyboards that support adjustable typematic(automatic key repeating) rates at the BIOS level.andP;  This includes mostmachines, starting with the AT, but not all clones.andM;The first optional decimal parameter, m, is a number between 0 and 31 thatrepresents the desired typematic rate.andP;  The larger the m value, the fasteryou keyboard will repeat keystrokes.andP;  The second parameter, n, has a range of0 to 3, and it sets the initial delay.andP;  This delay is the length of time youmust hold down a key before it begins repeating.andP;  The larger the delay value,the longer the delay.andP;  The delay parameters are in quarter-second increments,with 0=1/4 and 3=1 second.andP;  The typematic parameters are divisors and cannoteasily be translated into fractions of a second, however, so they should bethought of only as gradient scales.andM;If you don't enter any parameters, TYPEMATIC defaults to what I considerideal, a repeat rat eof 25 and a delay of 0.andP;  The 25 translates into about 17characters per second with an initial delay of a quarter second.andP;  You canrestore the typematic rate to the normal hardware defaults (11 characters persecond with a half-second delay) by using the N parameter.andP;  Just enterandM;BATCHMAN TYPEMATIC NandM;and the normal values of 20 and 1 will be used.andP;  Once you try adding a littlezoom to your keyboard, however, I don't think you'll ever go back to thehardware defaults.andM;Hopefully, the comments in the assembly listing will suffice for thoseinterested in the programming techniques.andP;  BATCHMAN is designed so thatprogrammers can easily add their own commands.andP;  All you need to do is add aprocedure for the new command and add the name of the command to the dispatchtable.andP;  Once you've had a chance to look at the listing, I think it will beself-explanatory.andP;  And, of course, as I mentioned above, I can always befound on PC MagNet.andP;  Come and join me there and we can delve into thetechnical details together.andM;Whether you are a programmer or not, however, BATCHMAN will make your systemsignificantly more responsive to your needs.andP;  To see just how flexibleBATCHMAN can be, check out this issue's Lab Notes, where Neil J. Rubenkingwill take BATCHMAN and literally make it sing.andM;Michael J. Mefford is a contributing editor of PC Magazine.andO;</TEXT></DOC>