<?xml version='1.0' encoding='UTF-8'?>
<DOC><DOCNO> ZF32-034-067 </DOCNO><DOCID>11 295 383</DOCID><JOURNAL>PC Magazine  Oct 15 1991 v10 n17 p429(3)* Full Text COPYRIGHT Ziff-Davis Publishing Co. 1991.andM;</JOURNAL><TITLE>User-to-user. (help for readers) (tutorial)</TITLE><AUTHOR>Rubenking, Neil J.andO;AttFile:   PCMAG\V10N17\MAKEDIR.BAT;0 Program:  MAKEDIR.BAT  Creates directory.andO;PCMAG\V10N17\MOV.BAT;0 Program:  MOV.BAT  Moves files andamp; shows common errors.andO;PCMAG\V10N17\MOVE.BAT;0 Program:  MOVE.BAT  Moves files andamp; reports any errors.andO;PCMAG\V10N17\SAFEMOVE.COM;2 Program:  SAFEMOVE.COM  Moves files safely.andO;PCMAG\V10N17\SAFEMOVE.SCR;0 Program:  SAFEMOVE.SCR  Script file.andM;</AUTHOR><DESCRIPT/><TEXT>byandM;Neil J. RubenkingandM;DIRECTORY OR FILE?andM;In a batch file, you can test for the existence of a particular directorywith the following line:andM;IF EXIST [path]\NUL [command]andM;To distinguish a directory from a file, combine that line with another IFEXIST statement, like this:andM;IF [not] EXIST [path]\NULandM;andlsqb;command 1]andM;IF [not] EXIST [path] [command 2]andM;For example, if you refer to C:\ABC\FOO, where FOO is a file, thenandM;IF EXIST C:\ABC\FOO\NULandM;will not be true, butandM;IF EXIST C:\ABC\FOOandM;will be true.andM;As a general rule, you shouldn't use a command that acts directly on a \NUL-appended FOR variable.andP;  For example, the lineandM;FOR %%f IN (C:\ABC\NUL C:\DEF\NUL)andM;DO IF EXIST %%f COPY XYZ %%fandM;won't work the way you want.andP;  In such cases, do the tests as separatestatements:andM;IF EXIST C:\ABC\NUL COPY XYZandM;C:\ABCandM;However, the FOR statement will work with input variables:andM;FOR %%f IN (%1\NUL %2\NUL) DO IFandM;EXIST %%f COPY XYZ %1andM;Any DOS standard device (such as PRN or CON) can be used to test for theexistence of a directory; however, it's a much better idea to get into thehabit of using NUL, which won't get you into trouble if you make a weird typoin your batch file.andM;David SimonsandM;New York, New YorkandM;Just in case the usefulness of this tip isn't immediately apparent, I wrote alittle batch file called MAKEDIR.BAT, shown in Figure 1.andP;  The aim of thisbatch file is to create a subdirectory off the current directory calledNEWDIR.andP;  It tests and reports four different situations:andM;1.andP;  Can't create NEWDIR because a file by that name exists.andM;2.andP;  Creates a new directory NEWDIR.andM;3.andP;  Directory NEWDIR already exists and is empty.andM;4.andP;  Directory NEWDIR already exists and contains files.andM;To test MAKEDIR.BAT, try this.andP;  Create a 0-byte file called NEWDIR with thecommand REM andgt; NEWDIR and then run MAKEDIR.andP;  It reports that it can't make thedirectory.andP;  Delete the file NEWDIR and run MAKEDIR twice again.andP;  The firsttime, it reports that it's creating the directory; the second time, that italready exists with no files in it.andP;  Now copy any file into directory NEWDIRand run MAKEDIR once more.andP;  This time it tells you that the directory existsand contains files.andM;Suppose MAKEDIR were the start of an INSTALL batch file that needs to createa certain directory.andP;  In case 1, it would report the problem to the user andquit.andP;  Cases 2 and 3 are effectively the same; you're ready to proceed.andP;  Incase 4, you might check whether the files in the directory belong to aprevious version of the same program you're installing or to a differentprogram.andP;  Distinguishing these different cases can be quite handy!andM;Mr.andP;  Simons's cautions that using this technique with the FOR command may bea little confusing.andP;  The first FOR example is an attempt to copy the file XYZinto the two directories ABC and DEF if those directories exist.andP;  However,the result of that command will actually be to copy file XYZ to the NULdevice once for each directory that exists a pointless action.andP;  Yet you canfix that command to work as intended:andM;FOR %%f IN (C:\ABC C:\DEF) DO IFandM;EXIST %%f\NUL COPY XYZ %%fandM;The FOR variable gets set first to C:\ABC and then C:\DEF.andP;  If the NUL deviceexists in that directory, it's a valid directory and we can copy file XYZ toit safely.andM;The second FOR loop example is problematic.andP;  If either the first or secondparameter is the name of an existing directory, it copies a file to the firstdirectory.andP;  So if the second exists but the first doesn't, this commandattempts to copy the file to a nonexistent directory.andP;  You don't want to dothat!andM;MOVING FILESandM;Interrupt 21h function 56h provides a safe way to move files betweendirectories on the same drive.andP;  SAFEMOVE.COM, the assembled version ofSAFEMOVE.SCR (Figure 2) uses function 56h to move files.andP;  To use the program,just typeandM;SAFEMOVE oldpath\ filename newpathandM;Use a backslash if you specify a drive as part of oldpath when you move afile from the root directory (that is, use C:\filename, not C:filename).andP;  Youdon't have to type oldpath if the file you want to move is in the activedirectory.andP;  SAFEMOVE doesn't accept wildcard filenames, but you can createbatch files that will use them to make multiple moves.andP;  I use CLEANUP .BATwith the command CLEANUP *.BAK, like this:andM;@ECHO OFFandM;FOR %%f IN (%1) DO CALL MOVE %%f  \BAKandM;to keep backup files in one directory.andM;SAFEMOVE.COM is much faster than the usual combination of XCOPY and DELETE.andO;One drawback, though, is that SAFEMOVE won't give you any information abouterrors.andP;  If you want more information about errors, use SAFEMOVE indirectlyby calling it from a batch file like MOVE.BAT (Figure 3(a)), which is calledby CLEANUP.BAT.andM;SAFEMOVE.COM fails ifandM;a file with the new pathname already exists;andM;any element of the old pathname does not exist;andM;you try to move a file from one drive to another;andM;you're moving the file to the root directory and the root directory is full.andM;Jean S. LaRochelleandM;Beauport, Quebec, CanadaandM;The usual way to move a file from one directory to another is to copy it andthen delete the original.andP;  Automating this process requires a lot oferror-checking; you don't want to take the chance of deleting the originaluntil you're absolutely sure the copy was successful.andP;  When you use the DOSinternal rename function (DOS function 56h), the file data doesn't get movedat all.andP;  That's why it's safe! You can rename the full pathname of a file,and it will look like you've moved it from one directory to another.andP;  Butactually nothing has changed except the directory entries.andM;To create SAFEMOVE.COM from the script in Figure 2, give the commandandM;DEBUG andless; SAFEMOVE.SCR andgt;andM;SAFEMOVE.LOGandM;Now scan SAFEMOVE.LOG and look for any lines that contain &quot;^Error&quot;.andP;  If youfind any, correct them and try again.andP;  Otherwise, SAFEMOVE.COM is ready touse.andM;Most of SAFEMOVE.COM is devoted to parsing the command line and setting upthe registers for the DOS function call.andP;  Registers DS:DX must point to thecurrent full pathname, and ES:DI to the new pathname.andP;  Once that's beenarranged, the program moves 5600h into the AX register and calls INT 21h.andP;  Ifthere is any trouble, the carry flag is set and the error number is put inthe AL register.andP;  If there is no trouble, 0 is put into the AL register.andP;  Thefinal call to INT 21h, function 4Ch ends the program with the Errorlevel setto whatever was in AL.andM;MOVE.BAT reports a couple of the possible errors returned by SAFEMOVE butmisses two common ones.andP;  Error number 5, Access Denied, usually means thatthe destination filename already exists.andP;  And error number 17 specificallymeans that you've attempted to rename the file onto a different drive.andO;MOV.BAT (Figure 3(b)) is a modified batch file that specifically reportsthese two errors.andM;SHARE YOUR SECRETSandM;Reveal your latest DOS and systems discoveries through User-to-User; we'llpay you $50 for any submission we print.andP;  Please submit your letter on a disktogether with a printout.andP;  Mail your contribution to User-to-User, PCMagazine, One Park Avenue, New York, NY 10016, or upload it to PC MagNet (seepage 10 for access instructions).andP;  We regret that we are unable toacknowledge submissions or answer questions individually.andO;</TEXT></DOC>