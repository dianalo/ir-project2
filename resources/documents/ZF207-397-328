<?xml version='1.0' encoding='UTF-8'?>
<DOC><DOCNO>  ZF207-397-328  </DOCNO><DOCID>07 397 328.andM;</DOCID><JOURNAL>Hewlett-Packard Journal  June 1989 v40 n3 p58(7)* Full Text COPYRIGHT Hewlett Packard 1989.andM;</JOURNAL><TITLE>Videoscope: a nonintrusive test tool for personal computers.andO;(includes related article on video signature analyzer operation)(technical)</TITLE><AUTHOR>Tuttle, Myron R.; Low, Danny.andM;</AUTHOR><SUMMARY>Hewlett-Packard's Videoscope system performs nonintrusive,automated performance, compatibility and regression testing ofapplications running on the company's HP Vectra PersonalComputers.andP;  The user enters test data manually, but the Videoscopesystem automatically executes the application that uses the data,uses signature analysis techniques to test the application anddisplays and records the results.andP;  The Videoscope system consistsof the 'vscope' program which is used to create and execute thetests and the Videoscope board which links the host system to thesystem under test.andP;  Details of the design and functioning of thesoftware and board are described.andP;  The Videoscope system is notavailable as a product.andM;</SUMMARY><DESCRIPT>Company:   Hewlett-Packard Co. (products).andO;Ticker:    HWP.andO;Product:   HP Videoscope (Test equipment, electronic) (design andconstruction).andO;Topic:     SpecificationsCompatible HardwareProgram TestingApplicationsTest Equipment.andO;Feature:   illustrationchart.andO;Caption:   An overview of the operation of the Videoscope system. (chart)Typical setup for using the Videoscope system with an HP VectraPC. (chart)Data flow during test script recording. (chart)andM;</DESCRIPT><TEXT>Videoscope: A Nonintrusive Test Tool for Personal ComputersandM;INTERACTIVE TESTING OF APPLICATION SOFTWARE requires the tester to sit at thetest system and enter test data using a keyboard and/or some other inputdevice such as a mouse, and observe the results on the screen to determine ifthe software being tested produces the correct results for each set of testdata.andP;  This process is time-consuming and error-prone if it is done manuallyeach time the tester wants to repeat the same set of tests.andP;  This processmust be automated to ensure adequate test coverage and improve theproductivity of testing.andM;Videoscope is a test tool developed and used by HP's Personal Computer Group(PCG) for automated performance, compatibility, and regression testing ofinteractive applications running on HP Vectra Personal Computers.andP;  It isindependent of the operating system and nonintrusive.andP;  Nonintrusive meansthat it does not interfere with or affect the performance and behavior of theapplication being tested or the operating system.andP;  Videoscope is for internaluse and is not available as a product.andM;An overview of the operation of Videoscope is illustrated in Fig.andP;  1.andP;  Duringtest creation the tester manually enters test data to the application beingtested and waits for the correct result to show on the display.andP;  As thetester enters the test data, Videoscope records the data into a file called atest script.andP;  At the command of the tester Videoscope also records the screenresult in the test script.andP;  The tester continues this process for each set oftest data and at the end of testing the test script contains a sequence oftest data interspersed with correct screen results.andP;  For retesting the sameapplication, Videoscope automates the process by replacing the tester andplaying back the test script to the application (Fig.andP;  1b).andP;  The test data issent to the application as it was entered during test recording.andP;  Whenever ascreen result is encountered in the test script, Videoscope waits for it tooccur on the display and then automatically does a comparison between thecurrent screen and the correct screen results in the test script to determineif the test passes or fails.andM;The concepts and motivation for developing Videoscope evolved fromexperiences with trying provide the best test coverage of applicationsrunning on the HP Vectra PC.andP;  When the HP Vectra PC was developed, a majorgoal of the product was that it be compatible with the industry standardsestablished by the IBM PC/AT.andP;  Compatibility was determined by runningvarious applications written for the IBM PC/AT and evaluating how well theyran on the Vectra.andP;  The first iteration of testing was done by hand usingmost of the engineers in the lab.andP;  This was clearly an inefficient andexpensive way to run these tests.andP;  The tests were then automated using twoutility programs, Superkey and Sidekick from Borland InternationalIncorporated.andP;  Superkey was used to capture and play back keystrokes, andSidekick was used to capture screen displays and save them to disc fileswhere they were compared with files containing known-correct screen displays.andO;These tools and certain standards for creating tests were called theregression test system (RTS).andM;While RTS initially proved adequate, long-term use revealed weaknesses in thesystem.andP;  First, mouse movements could not be captured or played back, so anyprogram that used a mouse had to be tested by hand.andP;  Second, the system wasintrusive.andP;  This meant that certain programs did not act the same when RTSwas loaded.andP;  The deviations ranged from running differently to not running atall.andP;  For example, Microsoft Windows could not run at all with RTS because ofconflicts over control of the interrupt vectors.andP;  Other applications couldnot run because RTS used up so much memory that there was not enough left forthe application.andP;  Finally, RTS could not be used to do performance testingsince it used system resources and affected the performance of the system.andM;Videoscope was developed to replace RTS and to compensate for its weaknesses.andO;This resulted in the following design objectives for the Videoscope system:andM;* It had to have the same capabilities as RTS.andM;* It had to be nonintrusive.andM;* It had to be able to do controlled-time and real-time performance testing.andO;Controlled-time means that fixed time delays are inserted in the test scriptsto control when certain events take place on the system under test.andO;Real-time performance testing means the ability to determine the actualresponse time of events taking place on the system under test.andM;* It had to be able to handle a mouse and any other pointing device that HPsells for the Vectra.andM;* It had to support HP extensions to the PC standard.andM;* Test scripts had to be portable.andP;  The intent of this objective is to beable to port test scripts to other PC operating systems such as Xenix, OS/2,or even HP-UX.andP;  It was also considered necessary to be able to use amultitasking computer system such as the HP 3000 Computer System as a host totest multiple systems on playback.andM;* It had to be able to handle a list of programs (e.g., Microsoft Windows andHP AdvanceWrite) that we needed to test but were unable to test with RTS.andM;Videoscope SystemandM;The Videoscope system consists of two major parts: a program called vscopethat resides in a system known as the host system, and a board called theVideoscope board that occupies one slot in the PC running the applicationbeing tested (see Fig.andP;  2).andP;  This system is called the system under test(SUT).andP;  The vscope program is used by the tester to create and perform theactual tests.andP;  The videoscope board provides the links to the keyboard andpointing device (i.e., mouse, tablet, etc.) ports on the SUT.andP;  Theseconnections enable the host keyboard and pointing device to be used in placeof the SUT keyboard and pointing device during test recording.andP;  theVideoscope board is also connected to the video adapter of the SUT, whichenables it to capture the video signal of the screen contents of the SUT.andO;The video signal is used to compute a digital representation of the screen.andO;This representation is called a signature, and it is the signature that isstored in the test script.andM;Although two complete PCs are required for test development, the SUT does notneed to have a keyboard or pointing device.andP;  For playback, a monitor isoptional in the SUT since normally no human will need to look at it.andP;  Alsofor playback, it is possible to use any computer system with appropriatesoftware as the host--not just a PC.andP;  This satisfies the portabilityobjective.andM;Videoscope SoftwareandM;The vscope program provides the interface between the tester and therecording and playback features of the Videoscope system.andP;  For recording thetester uses the keyboard and pointing device on the host and runs theapplication being tested on the SUT (see Fig.andP;  3).andP;  The front routinecaptures the test data, which is composed of keystrokes from the keyboard andpointing device movements from the HP-HIL (HP Human Interface Link), convertsit to symbolic names, and passed it on to the parser.andP;  Tha parser performstwo functions with symbolic names: it saves them in the test script, and ittranslates them into commands for the videoscope board.andP;  These commands aretransmitted over the RS-232-D line to the videoscope board on the SUT.andO;Periodically, the tester must tell vscope to capture a screen display andsave it for comparison during playback.andP;  Each time a screen is captured asignature is computed by the code on the videoscope board and passed back tovscope to be saved in the test script.andP;  This whole process results in a testscript composed of two files.andP;  One file (test data) contains keystrokes,pointer device movements and picks, and markers for signatures, and the otherfile (signature file) contains the screen signatures.andP;  Because of blinkingfields and cursors on the display, vscope takes several signatures for onescreen result.andP;  A histogram of the signatures is built and only the mostfrequent ones are included in a signature list, which goes into the file.andM;The syntax of the symbolic names and the algorithm to interpret them is basedon those commonly used by PC keyboard macro programs.andP;  The reason for thisdesign decision was to maintain the look and feel of the RTS, and to reuseexisting data stuctures and algorithms.andM;Not all keys are recognized by the front routine.andP;  Keys that do not send datato the keyboard buffer (e.g., CTRL, Alt, Shift) are not recognized.andP;  Thesekeys, known as &quot;hot keys,&quot; are commonly used by terminate and stay resident(TSR) programs such as Superkey or Sidekick to activate themselves.andP;  TSRs areso commonly used in PCs that it was decided that vscope had to accommodatetheir presence on the host and the SUT.andP;  This created the problem of how tosend such nondata keys to the SUT.andP;  Fortunately, the solution to this problemwas a natural consequence of the method used to encode and decode thesymbolic names created by vscope.andP;  For example, the keystrokes Enter clsEnter dir /w [cmd]getcrc[cmd] results in a clear screen, a listing offilenames in wide format on the SUT, and the capture of the resulting screenin the signature file.andP;  These keystrokes result in the following stream ofsymbolic names being generated by the front routine: andless;ENTERandgt;clsandless;ENTERandgt;dir/wandless;ENTERandgt;[cmd]getcrc[cmd]andM;This stream is interpreted as follows:andM;* andless;ENTERandgt; - send press Enter key commandandM;* cls - send press C, L, and S key commandsandM;* andless;ENTERandgt; - send press Enter key commandandM;* dir /w - send press D,I,R,Space,/,and W key commandsandM;* andless;ENTERandgt; - send press Enter key commandandM;* [cmd]getcrc[cmd] - Execute getcrc commandandM;Presssing a key on the host means sending a press key command to thevideoscope board over the RS-232-D line.andP;  Under this scheme, an Enter key canbe inserted in the test script in two ways.andP;  The first way is to press theEnter key on the host keyboard.andP;  The second way is to press the andless; key, E key,N key, T key, E key, R key and andgt; key in that order.andP;  The pattern andless;ENTERandgt; willbe interpreted as a press Enter key entry.andP;  Under this scheme keys that donot generate data for the keyboard buffer can be entered by typing thesymbolic name of the key.andP;  For example, the hot key combination CTRL Alt,which is used to  invoke the TSR program Sidekick, can be sent to the SUT bytyping on the host keyboard andless;ctrlaltandgt;.andP;  Just pressing CTRL and Altsimultaneously would invoke Sidekick on the host.andP;  With this scheme any keycombination can be sent to the SUT and not cause distruption on the host.andM;The pattern [cmd] is used to mark the beginning and end of a vscope command.andO;Some vscope commands translate directly into commands used by the Videoscopeboard firmware, and other commands are used only by vscope.andP;  For example, thevscope set command translates directly into a Videoscope firmware command toset switches on the board.andP;  On the other hand, the vscope log command, whichwrites information to a file on the host system, has no association with theVideoscope board.andP;  Other commands translate into a complex series ofoperations.andP;  The getcrc command is such an example.andP;  During test scriptrecording this command retrieves the screen signature and stores it in thesignature file.andP;  During test script playback, it reads the signatures fromthe test script file, compares them with the current screen signature andreports the results.andM;Keystrokes and mouse movements are sent as quickly as possible to theapplication.andP;  A method is provided for slowing them down to a fixed maximum(time command).andP;  Associated with each HP-HIL transaction is a delay which canbe set from 0 to 32,767 milliseconds.andP;  The effect of this delay is to limitthe maximum speed at which mouse movements are sent to the application.andP;  Manymouse-orinted applications can lose mouse movements if they come too fast.andO;Normally this is of no concern when the user is part of a closed feedbackloop and can reposition the mouse.andP;  Videoscope is not tolerant of anydifferences on the display that would be caused by missing a mouse movement.andO;By experimentally changing the delay value, the test can be run at themaximum speed that gives consistent results.andP;  Keystrokes can be programmedwith separate press and release delays.andP;  Each of these delays can bespecified in increments of 32 milliseconds over the range of 32 to 8,160milliseconds.andP;  This gives a maximum typing speed of about 180 words perminute.andP;  Allowing these fixed and varying wait times to be inserted betweenkeystrokes provides a method for modeling user think times for performancemeasurements.andM;For playback mode the tester runs the vscope program, selects the playbackoption, and specifies the test script files to use.andP;  In vscope the playroutin shown in Fig.andP;  4 reads the symbolic names from the test script andsends them to the parser.andP;  This time the parser does not create another testdata file but just translates the data stream and sends it to the SUT.andO;Whenever a signature marker is encountered in the test data file, theassociated signature list is retrieved from the signature file and passed tothe Videoscope board.andP;  The Videoscope board will compare the current screensignatures with signatures passed from vscope and send back a pass or failindication depending on the outcome of the comparison.andP;  If a test fails,vscope will either log the result and continue testing or halt furthertesting.andP;  This decision is based on the options specified by the tester whenvscope is set up for playback.andM;In addition to test recording and playback, vscope provides another operatingmode called the replay or regeneration mode.andP;  Screen signatures are highlydependent on the video system in use.andP;  Even though the display may lookexactly the same, signatures from an HP multimode card and a monochrome cardare different.andP;  If a test developed using a multimode card needs to be playedback on a monochrome card (e.g., to test whether the software properlysupports the monochrome card), a new set of signatures for the monochromecard needs to be captured.andP;  The replay mode automates this process by playingback the test data file and replacing the old signatures with new signaturesinstead of comparing them as it would in a normal playback.andP;  A single testdata file can access various signature files, allowing it to be used withseveral video hardware configurations.andM;Videoscope BoardandM;The Videoscope board is partitioned into two major sections: the Videoscopeprocessor and the system under test interface (see Fig.andP;  5).andP;  The twosections operate independently and are connected by an 8-bit bidirectionalport.andP;  The processor contains the video signature analyzer (VSA) and thekeyboard/HP-HIL emulator.andP;  The Videoscope board is a full-length PC/AT-styleaccessory board (it can be used in a PC/XT-size machine if the cover is leftoff).andP;  During normal operation the board derives power from the + 5Vdc, - 12Vdc, and + 12Vdc lines of the SUT backplane.andP;  The PC/AT extended backplaneconnector is used only to access the additional interrupt lines.andM;Videosope Processor.andP;  The Videoscope processor is based on an Intel 80188microprocessor.andP;  This microprocessor was chosen because of its low cost andhigh level of integration, and the fact that it used the same languagedevelopment tools as the Intel 80286.andP;  The 80188 contains built-in timers,DMA controllers, an interrupt controller, and peripheral select logic.andP;  Iteliminates the need for at least two 40-pin packages and severalsmaller-scale chips.andM;The processor system is equipped with 32K bytes of ROM and 8K bytes of RAM.andO;Connected as peripheral devices are a UART for datacom, two HP-HIL slave linkcontrollers (SLC) for implementing two HP-HIL interfaces, the video signatureanalyzer, several switches, an LED indicator register, a port to emulate theDIN keyboard, and the SUT interface.andP;  The slave link controllers are HPproprietary chips for implementing the HP-HIL protocol.andM;The Videoscope processor firmware is written entirely in Intel 80188 assemblylanguage.andP;  It is modular and all main routines are reached through a jumptable in RAM.andP;  A loader function is provided so that a user can write acustom module and download it into the processor RAM.andP;  The jump table can beoverwritten so that the downloaded module is executed instead of theROM-resident code.andP;  There is a command (normally a null operation) that canbe used as the entry to a user module.andP;  The firmware is structured as areal-time interrupt-driven system.andP;  The code normally sits in an idle loopuntil a command needs to be processed or an interrupt serviced.andP;  Some of thecommand processing routines themselves introduce new interrupt serviceroutines for their operation.andM;Communication with the host system is through the RS-232-D interface shown inFig 5.andP;  The firmware supports up to 9600 baud using a straightforwardcommand-response protocol with a simple DC1 handshake.andP;  The ACK/ENQ protocolused on the HP 3000 is also supported.andP;  All data transfers between the hostand Videoscope are in ASCII hexadecimal characters.andP;  This was chosen to allowcomplete independence from the host datacom.andP;  It also enables test scripts bestored in readable and editable form.andP;  No compilation or decompilation of thescripts is necessary.andP;  All commands and data from the host parser routine tothe Videoscope processor are of the form: *andless;commandandgt;andless;lengthandgt;andless;data specific tocommandandgt;andless;checksumandgt;CR DC1 with all commands beginning with the marker * andall data characters, including the andless;commandandgt; and andless;lengthandgt; fields included inthe checksum.andP;  The commands recognized by the firmware include the following:andM;* Set Attribute (*A).andP;  Allows the host software to change default settings.andM;* Load Siglist (*C).andP;  Implements downloading of signature lists for screenmatching.andM;* HP-HIL (*H).andP;  Sends an HP-HIL device X, Y, and button data frame over theHP-HIL interface.andM;* Include (*I).andP;  Sets the start and stop limits of the area of the screen toinclude in a signature.andP;  Used to avoid time variant areas of the screen.andM;* Keystroke (.suP.*.J .sup.*.K).andP;  Sends a keystroke keycode and shiftmodifier.andP;  The *J form uses default timing while the *K form allows explicitpress and release times.andM;* Load (*L).andP;  Implements downloading of code routines.andM;* Resend (*R).andP;  Resends the last data record in case of datacom error.andM;* Signature (*S).andP;  Takes a signature of the screen.andP;  Used for building thesignature file for later playback.andM;* Test and Report (*T).andP;  Provides dumps of various sets of variables.andM;* Wait for Match (*W).andP;  Compares screen signatures until either thedownloaded list is matched or a time-out occurs.andM;Responses to the host are of the form: andless;+ -andgt;andless;optional dataandgt;CR LF where the +indicates successful completion of the command and - indicates failure.andP;  Theoptional data varies by command.andP;  For successful completion the field maycontain actual data.andP;  If it does, it is in a format similar to a command,including a length and a checksum.andP;  In the case of a failure, an error code,followed by an optional verbose error message (enabled by a switch), isreported.andM;Video Signature Analyzer.andP;  The VSA is the key component of the Videoscopeconcept.andP;  By using the technique pioneered by the HP 5004A Digital SignatureAnalyzer, it is possible to monitor the video signals generated by the SUT'sdisplay adapter in real time in a totally nonintrusive manner.andP;  The maincomponent of the signature analyzer is a 24-bit linear feedback shiftregister.andP;  The linear feedback shift register is used to accumulate asignature (similar to a cyclic redundancy check) of the video data stream.andO;The signature is a 6-digit hexadecimal number that describes the state of thescreen.andP;  The linear feedback shift register is a pseudorandom numbergenerator driven by the video signal.andP;  This means that even a one-pixeldifference will change the signature.andP;  A state machine using the display'shorizontal and vertical sync signals controls when the signature is taken.andO;Since some applications put time variant data on the screen such as dates, aclock, or file names and paths, a method is provided to allow the signatureto be started and stopped by a count of scan lines after the start of thedisplay.andP;  In this way only the nonvariant portion of the screen will beincluded in the signature.andM;To accommodate the various display adapters used in a PC, the video signatureanalyzer has an eight-input multiplexer which can select from eight separatevideo streams.andP;  This allows exhaustive testing of all image planes in amultiplane adapter (e.g., EGA or VGA) and minimizes testing when thedifferent planes contain redundant information.andP;  The tester can use thevscope set command to control how many planes are signatured.andP;  A separatesignature is computed for each plane, and when doing a multiplane match to asignature list, all enabled planes must match or a failure is reported.andM;To reduce the part count while maintaining reasonable precision and speed,the linear feedback shift register is wired as 22-bit maximum length with anadditional two bits following.andP;  This provides a maximum pattern length of 4 X(2.sup.22 - 1) states.andP;  Although a typical display has many more states thanthis (a 640 X 350-pixel display has over 2.sup.224000 distinct states), theprobability of having an  incorrect display with a valid signature isextremely low.andP;  In instances where a match of an invalid screen (an aliassignature) does occur, the next screen signatured will almost certainly fail.andO;Very few alias signatures have been detected in actual use.andM;The VSA is controlled from the Videsoscope processor by a high-speed statemachine implemented partially in hardware and partially in firmware.andP;  Thefirmware uses a state machine consisting of an idle loop and severalinterrupt service routines.andP;  The present hardware portion of the statemachine will operate with video dot rates in excess of 50 MHz and scan ratesin excess of 32 kHz.andP;  See the box on page 62 for more details about the VSAstate machine architecture.andM;At the completion of the signaturing process the firmware can either pass thesignature back to the host or compare it against a list of valid signaturesdownloaded from the host.andP;  The first method is generally used during scriptcreation when the vscope program is building the signature list file, and thesecond method is used during test script playback.andP;  Datacom traffic is keptto a minimum by downloading lists of signatures and doing the comparisonslocally on the VSA board.andM;Keyboard/HP-HIL Emulator.andP;  Videoscope has the capability of emulating thekeyboard used on the earlier Vectra models as well as the industry standardDIN keyboard used in both the PC/XT and Pc/AT protocols.andP;  The new Vectramodels use the DIN keyboard and are compatible with the PC/XT and PC/ATprotocols.andP;  For the HP-HIL interface, there are two slave controller chips onthe board, which are capable of emulating any two of the following devices: amouse, a tablet, a touchscreen, or a keyboard.andP;  The controllers are directlydriven by routines in the Videoscope processor firmware and no additioanlprocessors are needed.andP;  Additional devices can be emulated by changing thefirmware.andM;SUT Interface.andP;  The SUT interface port provides a communication path betweenthe Videoscope processor and the SUT processor.andP;  This is an 8-bitbidirectional port with provision for generating an interrupt wwhen writtento.andP;  In the SUT this can neither be a nonmaskable interrupt (NMI) or any oneof the interrupt (INTRn) lines on the backplane.andP;  The desired line isselected by a switch.andP;  The SUT must have an interrupt handler installed forthis feature to be used.andP;  Also included in the SUT interface are 8K bytes ofROM and 8K bytes of RAM.andP;  This 16K-byte address space can be configuredwithin the C0000-DFFFF address range of the SUT.andP;  The ROM is seen by the SUTpower-up routines as an option ROM and normally includes the necessaryinterrupt handler.andP;  The I/O ports of the SUT interface can be located at anyof several addresses normally reserved for the IBM prototype card.andP;  Both thememory and the I/O ports can be relocated to avoid conflicts with hardwareinstalled in the SUT.andP;  The current implementation of the Videoscope systemdoes not make use of the SUT interface.andP;  However, the hooks are available forusers to create routines for special-purpose testing requirements.andM;ConclusionandM;Videoscope has met or exceeded the original objectives established for thesystem.andP;  One minor disappointment is that the the signature generated fromthe video signal is not unique.andP;  However, the probability of two screenshaving the same signature is very small, so this is a very minor problem andsimple workarounds have been found.andM;The design and implementation of Videoscope was highly leveraged.andP;  The videosignature analysis hardware and firmware are based on the HP 5004A SignatureAnalyzer.andP;  The data structures and algorithms for interpreting data in thescript file are based on those commonly used by keyboard macro programs, andthe data communication software used by vscope to communicate with theVideoscope processor firmware is a package called Greenleaf Data Comm Libraryfrom Greenleaf Software, Inc.andM;Videoscope provides a major productivity tool to improve the quality ofsoftware.andP;  The PC intrinsically is an interactive computer system.andP;  Thismeans that batch-style tests cannot adequately test the capability of anysoftware written for a PC.andP;  Videoscope provides an automatic alternative toslow, error-prone, and expensive manual testing.andP;  Currently there are over100 Videoscope systems in use at 18 HP divisions.andM;AcknowledgmentsandM;We would like to acknowledge the help of our manager, Jean-Claude Roy, whomade a major contribution to the design of Videoscope, and the entireVideoscope design review team, in particular John Schimandle who providedmuch appreciated user feedback.andP;  The development of Videoscope was acorporatewide effort involving may people, and so we thank all of those whocontributed to the successful development of Videoscope.andO;</TEXT></DOC>