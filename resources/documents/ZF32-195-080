<?xml version='1.0' encoding='UTF-8'?>
<DOC><DOCNO> ZF32-195-080 </DOCNO><DOCID>10 434 274</DOCID><JOURNAL>PC Magazine  March 26 1991 v10 n6 p379(3)* Full Text COPYRIGHT Ziff-Davis Publishing Co. 1991.andM;</JOURNAL><TITLE>Databases. (question and answer) (column)</TITLE><AUTHOR>Ricciardi, Sal.andO;AttFile:   PCMAG\V10N06\DBLEAP.PRG;0 Program:  DBLEAP.PRG  Check leap year in DBASE IV.andO;PCMAG\V10N06\LEAPTEST.PRG;0 Program:  LEAPTEST.PRG  Check leap year in Clipper.andO;PCMAG\V10N06\STRU.PRG;0 Program:  STRU.PRG  List structure of Clipper file.andM;</AUTHOR><DESCRIPT/><TEXT>CHECKING FOR LEAP YEARSandM;I have just received a copy of Clipper 5.0.andP;  Included with this databasepackage is a collection of source code samples, which the standardinstallation process places in the \CLIPPER5\SOURCE\SAMPLE\ directory.andM;I've found that one of them, DATE .PRG, contains a leap year-testing functionthat's invalid.andP;  Here's the code supplied by Nantucket Corp.:andM;/***andM;*  DateIsLeap( andless;ddateandgt; ) --andgt; lLeapandM;*  Determine if the year of aandM;*  supplied date is a leap yearandM;*/andM;FUNCTION DateIsleap( dDate )andM;RETURN  (YEAR( dDate ) % 4) = 0;andM;.AND.andP;  .NOT.andP;  ((YEAR( dDate );andM;% 400)= 0)andM;Execute this function, and you'll find that 1700,1800, and 1900 are leapyears, while 2000 is not.andP;  Actually, just the opposite is true.andM;Fortunately, Clipper's CTOD() function correctly recognizes  &quot;2/29/2000&quot; asvalid and  &quot;2/29/1900&quot; as invalid.andP;  Since this is true for both Clipper 5.0and Clipper Summer 87, a more accurate leap year test is simply to return T.andO;if 2/29 is a valid date for the given year, and .F.andP;  if it is not:andM;FUNCTION IsLeapandM;PARAMETER DandM;RETURN !EMPTY(CTOD('02/29/' + ;andM;ALLTRIM(STR(YEAR(D)))))andM;This syntax will work with either the 5.0 or with the Summer 87 version.andP;  UseLEAPTST.PRG to try out IsLeap.andM;As you may know, Julius Caesar is credited with the establishment of the leapyear.andP;  In 45 B.C.andP;  he or his advisers determined that our annual trip aroundthe sun was 365 and one quarter days.andM;Over 1,600 years later, astronomers and mathematicians convinced Pope GregoryXIII that the journey was more like 365 days, 5 hours, 48 minutes, and(almost) 48 seconds.andP;  This slight difference in time amounts to 10 days overthe course of 16 centuries, and thus the Pope decreed that the date following10/4/1582 was to be 10/15/1582.andM;In addition, the new Gregorian Calendar revised the leap year rule anddropped 2/29 from years ending in 00.andP;  This still left a small margin oferror, however.andP;  So an exception to the exception was included, which statedthat years evenly divisible by 400 would indeed be leap years.andP;  (Still, thisformula is off by about 1 day every 3,000 years.)andM;Only once (on the date 2/29/1600) has the 400-year exception been invoked.andO;It will happen again in a little over 9 years from now and I'd like myprograms to be able to handle it !andP;  Robert C. AshcraftandM;Christiansburg, VirginiaandM;Only the earliest Clipper 5.0 releases contained the erroneous function shownabove.andP;  Nantucket has since corrected the bug, and a working version ofDatelsLeap is included in currently shipping copies of 5.0.andM;Mr.andP;  Ashcroft's use of February 29 to test for leap-year validity iseffective and easily ported to FoxPro or FoxBASE Plus.andP;  It relies on the factthat Clipper 5.0, Clipper Summer 87, FoxPro, and FoxBASE Plus all return anempty date when an invalid date string such as &quot;02/29/90&quot; is passed toCTOD().andP;  This causes the EMPTY function to return  .T.andP;  in the IsLeapfunction, which then returns .F.andP;  to the caller.andP;  If the CTOD() functiondoesn't return a null date, then 02/29 is valid, and the year is indeed aleap year (EMPTY will return .F.andP;  and IsLeap will return .T.).andM;You should note that if you're using Ashton-Tate's DBASE, you can't use thistechnique.andP;  Unfortunately, as was shown in the February 12, 1991, Databasescolumn (&quot;Validating Date Strings&quot;), both DBASE' III Plus and DBASE [Vautomatically convert dates to an internal format and perform some impliedarithmetic without any date validity checks.andP;  So, for example,CTOD(&quot;02/29/90&quot;) in DBASE returns the date 03/01/90.andP;  This would not work inthe IsLeap function that's shown above, so a different technique is neededfor DBASE III users.andM;We can rely on dBASE's converting 02/29 to 03/01 in years that are not leapyears and construct a DBASE IV--only function as follows:andM;* FUNCTION IsLeap(date)andM;* Return T. if date isandM;* in a leap year, .F.andP;  if notandM;* dBAsE iv only versionandM;FUNCTION IsLeapandM;PARAMETER DandM;PRIVATE YandM;Y = TRIM(STR(YEAR(D)))andM;RETURN ;andM;( CTOD(&quot;02/29/&quot;+Y) andless; ;andM;CTOD('03/01/&quot;+Y) )andM;This will return .T.andP;  only for years in which dBASE considers  &quot;02/29&quot; reallyto be 02/29.andP;  The program in Figure 2 [omitted] is a version of LEAPTST.PRGthat uses the dBASE version of IsLeap.andM;DISPLAYING.DBF STRUCTURESandM;When developing procedures for a new database, I often find myself forgettingwhat I named a field or how much space I allowed the field to occupy.andP;  SinceI work mostly with Clipper, I need to either call DBU.EXE or use DBASE inorder to list the structure.andP;  To save myself time I wrote STRU.PRG to listthe structure of a database file.andM;STRU will list the structure to the screen or create a text file that can beread into my editor, thus saving me from retyping field names when using themin a program.andM;Steven D. BoemierandM;Barnhart, MissouriandM;If you're using Clipper, this may come in handy for displaying DBF structuresfrom the DOS prompt--such as after you shell to DOS from your word processor.andO;Indeed, Nantucket really should include a similar command line utility withthe Clipper product itself.andM;Since Clipper doesn't have dBASE's DISPLAY STRUCTURE and LIST STRUCTUREcommands, Mr. Boemler had to resort to creating a temporary database to holdthe .DBF's structure using the commandandM;COPY TO tempandM;STRUCTURE EXTENDEDandM;Just one caution: the temporary database is called TEMP.DBF, and a temporaryfile named TEMP1234.XXI is also used--make sure you don't have any files withthe same name or they will be overwritten.andM;LET US HEAR FROM YOUandM;Share your database experience, tips, and techniques with our readers; we'llpay you $50 for any submission we print.andP;  Submit your letter on-disk,together with a printout.andP;  Mail your contribution to Databases, PC Magazine,One Park Avenue, New York, NY 100 16, or upload it to PC MagNet.andM;Sal Ricciardi is a New York-based consultant and a frequent contributor to PCMagazine.andO;</TEXT></DOC>